<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Posts &middot;  Erlang &amp; Go" />
  	<meta property="og:site_name" content="Erlang &amp; Go" />
  	<meta property="og:url" content="https://jeidee.github.io/posts/" />
    
    
    <meta property="og:type" content="website" />
    

  <title>
     Posts &middot;  Erlang &amp; Go
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://jeidee.github.ioimages/favicon.ico">
	  <link rel="apple-touch-icon" href="https://jeidee.github.ioimages/apple-touch-icon.png" />
    
    <link rel="stylesheet" type="text/css" href="https://jeidee.github.iocss/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://jeidee.github.ioindex.xml" rel="alternate" type="application/rss+xml" title="Erlang &amp; Go" />
      
      
        <link href="https://jeidee.github.io/posts/index.xml" rel="alternate" type="application/rss+xml" title="Posts &middot; Erlang &amp; Go" />
      
    
    <meta name="generator" content="Hugo 0.31.1" />

    <link rel="canonical" href="https://jeidee.github.io/posts/" />

    
<div id="particles-js"></div>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="https://jeidee.github.iojs/particles.js"></script>   
</head>
<body class="nav-closed">

  


 <div class="site-wrapper">




	<header class="main-header tag-head no-cover">

    <nav class="main-nav overlay clearfix">
      
      
        
          <a class="menu-button icon-feed" href="https://jeidee.github.io/posts/index.xml">&nbsp;&nbsp;Subscribe</a>
        
      
    </nav>
    <div class="vertical">

        <div class="main-header-content inner">
            <h1 class="page-title">

              <a class="btn-bootstrap-2" href="#content">Erlang &amp; Go</a>
          </h1>
        </div>
</div>
    <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    

	<div class="extra-pagination inner">
    <nav class="pagination" role="navigation">
	
	    <a class="newer-posts" href="/posts/page/10/">&larr; Newer Posts</a>
	
	<span class="page-number">Page 11 of 20</span>
	
	    <a class="older-posts" href="/posts/page/12/">Older Posts &rarr;</a>
	
</nav>

	</div>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/05/02/android-circle-image-view/">android Circle Image View</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>ImageView를 round처리하거나 원형으로 처리하고자 할 때 사용할 수 있는 방법은 다음과 같다.</p>

<p>먼저 <a href="https://github.com/chrisbanes/philm/blob/master/app/src/main/java/app/philm/in/drawable/RoundedAvatarDrawable.java">RoundedAvatarDrawable</a> 클래스를 다운로드 받아 프로젝트에 추가한다.</p>

<p>레이아웃에 ImageView를 하나 추가한 후 Activity의 onCreate()함수 안에서 다음과 같이 코딩한다.</p>

<pre><code class="language-java">          
BitmapDrawable bImage = (BitmapDrawable) getResources().getDrawable(R.drawable.unnamed);
          
ImageView mImg = (ImageView) mCustomView.findViewById(R.id.imageView1);
          
mImg.setImageDrawable(new RoundedAvatarDrawable(bImage.getBitmap()));
  
</code></pre>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/26630630/how-can-i-use-roundedavatardrawable-for-creating-round-image">How can i use RoundedAvatarDrawable for creating round image?</a></li>
<li><a href="http://www.kmshack.kr/%ED%9A%A8%EC%9C%A8%EC%A0%81%EC%9D%B8-bitmap-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%9D%BC%EC%9A%B4%EB%94%A9-%EC%B2%98%EB%A6%AC%EB%B0%A9%EB%B2%95/">효율적인 Bitmap 이미지 라운딩 처리 방법</a></li>
<li><a href="http://chiwoos.tistory.com/185">네모난 비트맵을 둥글게 사용하기</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/circled/">#circled</a>,
            
                <a href="https://jeidee.github.iotags/imageview/">#ImageView</a>,
            
                <a href="https://jeidee.github.iotags/rounded/">#rounded</a>,
            
        
        <time class="post-date" datetime="2015-05-02T00:00:00Z">
            2 May 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/05/02/android-action-bareba5bc-ecbba4ec8aa4ed8580-ebb7b0eba19c-eb8c80ecb2b4ed9598eab8b0/">android action bar를 커스텀 뷰로 대체하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>Action Bar에 버튼을 추가하거나 삭제하는 등의 편집을 위해서는 <a href="https://developer.android.com/training/basics/actionbar/adding-buttons.html">menu/menu_xxx.xml을 편집</a>하면 된다.</p>

<p>조금 더 다양한 레이아웃을 사용하기 위해서는 <a href="http://javatechig.com/android/actionbar-with-custom-view-example-in-android">커스텀 뷰를 만들어</a> 사용해야 한다.</p>

<p>커스텀 뷰를 만들고 Action Bar의 높이 사이즈가 맞지 않을 경우 다음과 같이 styles.xml에 추가하도록 한다.</p>

<pre><code>      
&lt;style name=&quot;AppTheme&quot; parent=&quot;@android:style/Theme.Holo.Light&quot;&gt;
          
&lt;item name=&quot;android:attr/actionBarSize&quot;&gt;120dp&lt;/item&gt;
      
&lt;/style&gt;
  
</code></pre>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://javatechig.com/android/actionbar-with-custom-view-example-in-android">ActionBar with Custom View Example in Android</a></li>
<li><a href="https://developer.android.com/training/basics/actionbar/adding-buttons.html">Adding Action Button</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/actionbar/">#ActionBar</a>,
            
        
        <time class="post-date" datetime="2015-05-02T00:00:00Z">
            2 May 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/29/android-ndkec9790ec849c-stringstreamec9d84-ec93b8-eab2bdec9ab0-__atomic_fetch_add_4-eab480eba0a8-eba781ed81ac-ec9790eb9faceab080-ebb09cec839d/">android ndk에서 stringstream을 쓸 경우 __atomic_fetch_add_4 관련 링크 에러가 발생</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>Android.mk에 다음과 같이 추가한다.</p>

<pre><code>  
LOCAL_LDLIBS += -latomic
  
</code></pre>

<h2 id="출처">출처</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/23041401/android-ndk-stl-c-shared-w-libcxx-force-rebuild-results-in-stdstringstream-n">Android NDK STL c++_shared w/LIBCXX_FORCE_REBUILD results in std::stringstream NOP</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/error/">#error</a>,
            
                <a href="https://jeidee.github.iotags/ndk/">#ndk</a>,
            
        
        <time class="post-date" datetime="2015-04-29T00:00:00Z">
            29 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/27/android-ndk-c-ecbd94eb939cec9790ec849c-java-object-ec839dec84b1ed95b4ec849c-parametereba19c-eb8498eab8b0eab8b0/">android ndk c&#43;&#43; 코드에서 java object 생성해서 Parameter로 넘기기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p>java 클래스에 다음과 같은 staic 메소드가 있다.</p>

<pre><code class="language-java">  
public class MsgClient {
    
&amp;#8230;
    
public static void callbackRoster(RosterArray rosterArray) {
      
&amp;#8230;
    
}
  
</code></pre>

<p>RosterArray는 다음과 같을 때,</p>

<pre><code class="language-java">  
import java.util.HashMap;

public class RosterArray {
      
private HashMap&lt;String, Roster&gt; m_rosters;

public RosterArray() {
          
m_rosters = new HashMap&lt;String, Roster&gt;();
      
}

public void add(String jid, String name, int subscription) {
          
if (m_rosters.containsKey(jid)) {
              
Roster roster = m_rosters.get(jid);
              
roster.SetRoster(jid, name, subscription);
              
return;
          
}

Roster newRoster = new Roster(jid, name, subscription);
          
m_rosters.put(jid, newRoster);
      
}

&amp;#8230;
  
}

</code></pre>

<p>c++ 코드에서 MsgClient.callbackRoster(&#8230;)를 호출할 때 다음과 같이 사용할 수 있다.</p>

<pre><code class="language-cpp">  
void MsgClient::callbackRoster(const Roster&amp; roster) {
      
JNIEnv *env = getJNIEnv(m_jvm);
      
if (!env) {
          
LOGE(&quot;env is null!&quot;);
          
return;
      
}

jclass rosterCls = getClassID(env, &quot;com/jeidee/glooxforandroid/RosterArray&quot;);
      
jmethodID rosterConstructor = env-&gt;GetMethodID(rosterCls, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);
      
jmethodID rosterAdd = env-&gt;GetMethodID(rosterCls, &quot;add&quot;, &quot;(Ljava/lang/String;Ljava/lang/String;I)V&quot;);
      
jobject rosterObj = env-&gt;NewObject(rosterCls, rosterConstructor);

for (Roster::const_iterator it = roster.begin(); it != roster.end(); ++it) {
          
jstring jid = env-&gt;NewStringUTF((*it).second-&gt;jid().c_str());
          
jstring name = env-&gt;NewStringUTF((*it).second-&gt;name().c_str());
          
int subscription = (int)(*it).second-&gt;subscription();

env-&gt;CallVoidMethod(rosterObj, rosterAdd, jid, name, subscription);

env-&gt;DeleteLocalRef(jid);
          
env-&gt;DeleteLocalRef(name);
      
}

JniMethodInfo methodInfo;
      
if (! getStaticMethodInfo(m_jvm, methodInfo, &quot;com/jeidee/glooxforandroid/MsgClient&quot;, &quot;callbackRoster&quot;, &quot;(Lcom/jeidee/glooxforandroid/RosterArray;)V&quot;))
      
{
          
return;
      
}

//jstring stringArg = methodInfo.env-&gt;NewStringUTF(value);
      
methodInfo.env-&gt;CallStaticVoidMethod(methodInfo.classID, methodInfo.methodID, rosterObj);
      
//msg.methodInfo.env-&gt;DeleteLocalRef(stringArg);
      
methodInfo.env-&gt;DeleteLocalRef(methodInfo.classID);

env-&gt;DeleteLocalRef(rosterCls);
      
env-&gt;DeleteLocalRef(rosterObj);
  
}
  
</code></pre>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/ndk/">#ndk</a>,
            
        
        <time class="post-date" datetime="2015-04-27T00:00:00Z">
            27 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/27/android-urlec9790ec849c-ec9db4ebafb8eca780eba5bc-ebb984eb8f99eab8b0eba19c-eb8ba4ec9ab4eba19ceb939c-ebb09bec9584-imageviewec9790-ecb69ceba0a5/">android url에서 이미지를 비동기로 다운로드 받아 ImageView에 출력하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>Custome List Adapter의 getView() 함수 안에서 다음과 같이 사용한다.</p>

<pre><code class="language-java">  
new DownloadImageTask(pView.GetIconView()).execute(roster.vcard().photo());
  
</code></pre>

<pre><code class="language-java">      
private class DownloadImageTask extends AsyncTask&lt;String, Void, Bitmap&gt; {
          
ImageView bmImage;

public DownloadImageTask(ImageView bmImage) {
              
this.bmImage = bmImage;
          
}

protected Bitmap doInBackground(String&amp;#8230; urls) {
              
String urldisplay = urls[0];
              
Bitmap mIcon11 = null;
              
try {
                  
InputStream in = new java.net.URL(urldisplay).openStream();
                  
mIcon11 = BitmapFactory.decodeStream(in);
              
} catch (Exception e) {
                  
Log.e(&quot;Error&quot;, e.getMessage());
                  
e.printStackTrace();
              
}
              
return mIcon11;
          
}

protected void onPostExecute(Bitmap result) {
              
bmImage.setImageBitmap(result);
          
}
      
}
  
</code></pre>

<h2 id="출처">출처</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/5776851/load-image-from-url">Load image from url</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/asynctask/">#asynctask</a>,
            
                <a href="https://jeidee.github.iotags/image/">#image</a>,
            
        
        <time class="post-date" datetime="2015-04-27T00:00:00Z">
            27 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/23/android-ndk-jstring-to-charor-stdstring/">android ndk jstring to char*(or std::string)</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <pre><code class="language-cpp">  
string toString(JNIEnv* env, jstring in) {
      
char* nativeStr;
      
const char* temp = env-&gt;GetStringUTFChars(in, 0);
      
nativeStr = strdup(temp);
      
env-&gt;ReleaseStringUTFChars(in, temp);

LOGD(&quot;toString() %s&quot;, nativeStr);
      
return string(nativeStr);
  
}
  
</code></pre>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/string/">#string</a>,
            
        
        <time class="post-date" datetime="2015-04-23T00:00:00Z">
            23 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/22/android-ndk-native-cc-ecbd94eb939cec9790ec849c-java-ecbd94eb939c-ed98b8ecb69c/">android ndk, native c/c&#43;&#43; 코드에서 java 코드 호출</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>다음과 같이 두 가지 측면에서 접근할 수 있다.</p>

<ul>
<li>동일 쓰레드에서 jni call(java코드에서 native c/c++ 함수 호출)을 하고, 동일 스코프에서 java object의 함수를 호출하는 경우</li>
<li>호출측(java) 쓰레드와 콜백(native c/c++) 쓰레드가 다른 경우</li>
</ul>

<h2 id="동일-쓰레드에서-콜백-구현">동일 쓰레드에서 콜백 구현</h2>

<p>java</p>

<pre><code class="language-java">  
package com.jeidee.glooxforandroid;

public TestClient {
      
public native callbackTest();

public void testCallback(String param) {
          
Log.d(&quot;JNI&quot;, param);
      
}
  
}
  
</code></pre>

<p>native c++</p>

<pre><code class="language-cpp">  
include &quot;com\_jeidee\_glooxforandroid_NativeCall.h&quot;

#include &quot;client.h&quot;

JNIEXPORT void JNICALL Java\_com\_jeidee\_glooxforandroid\_NativeCall_callbackTest (JNIEnv *env, jobject obj) {
      
static jmethodID cb = NULL;
      
jclass cls = env-&gt;GetObjectClass(obj);

if (cb == NULL) {
          
cb = env-&gt;GetMethodID(cls, &quot;testCallback&quot;, &quot;(Ljava/lang/String;)V&quot;);
          
if (cb == NULL) return;
      
}

env-&gt;CallVoidMethod(obj, cb, env-&gt;NewStringUTF(&quot;call testCallback()&quot;));
  
}
  
</code></pre>

<p>JNI함수인 callbackTest()를 호출한 java측 object에 testCallback(String) 함수가 있을 경우 위의 코드는 정상 동작한다.</p>

<h2 id="서로-다른-쓰레드에서-콜백-구현">서로 다른 쓰레드에서 콜백 구현</h2>

<p>예를 들어, 소켓 클라이언트를 native c/c++ 코드로 구현했다고 가정해 보자.</p>

<p>클라이언트가 서버에 접속 후 서버에서 데이터를 수신했을때 java 코드에 콜백한다고 한다면,</p>

<p>데이터 수신하는 쓰레드(보통은 native 측에서 쓰레드 구현)와 호출측(java ui 쓰레드)의 쓰레드는 다르다.</p>

<p>이럴 경우 간단하게 콜백 받을 java측의 클래스에 static method를 생성해 다음과 같이 구현할 수 있다.</p>

<p>java</p>

<pre><code class="language-java">  
public TestClient {
      
public native callbackTest();

public static void testCallback(String param) {
          
Log.d(&quot;JNI&quot;, param);
      
}
  
}
  
</code></pre>

<p>native c++</p>

<pre><code class="language-cpp">  
JNIEnv\* getJNIEnv(JavaVM\* jvm)
  
{

if (NULL == jvm) {
          
LOGD(&quot;Failed to get JNIEnv. JniHelper::getJavaVM() is NULL&quot;);
          
return NULL;
      
}

JNIEnv *env = NULL;
      
// get jni environment
      
jint ret = jvm-&gt;GetEnv((void**)&amp;env, JNI\_VERSION\_1_4);

switch (ret) {
          
case JNI_OK :
              
// Success!
              
return env;

case JNI_EDETACHED :
              
// Thread not attached

// TODO : If calling AttachCurrentThread() on a native thread
              
// must call DetachCurrentThread() in future.
              
// see: http://developer.android.com/guide/practices/design/jni.html

if (jvm-&gt;AttachCurrentThread(&amp;env, NULL) &lt; 0)
              
{
                  
LOGD(&quot;Failed to get the environment using AttachCurrentThread()&quot;);
                  
return NULL;
              
} else {
                  
// Success : Attached and obtained JNIEnv!
                  
return env;
              
}

case JNI_EVERSION :
              
// Cannot recover from this error
              
LOGD(&quot;JNI interface version 1.4 not supported&quot;);
          
default :
              
LOGD(&quot;Failed to get the environment using GetEnv()&quot;);
              
return NULL;
      
}
  
}

// get class and make it a global reference, release it at endJni().
  
jclass getClassID(JNIEnv \*pEnv, const char\* className)
  
{
      
jclass ret = pEnv-&gt;FindClass(className);
      
if (! ret)
      
{
          
LOGD(&quot;Failed to find class of %s&quot;, className);
      
}

return ret;
  
}

bool getStaticMethodInfo(JavaVM\* jvm, JniMethodInfo &amp;methodinfo, const char\* className, const char \*methodName, const char \*paramCode)
  
{
      
jmethodID methodID = 0;
      
JNIEnv *pEnv = 0;
      
bool bRet = false;

do
      
{
          
pEnv = getJNIEnv(jvm);
          
if (! pEnv)
          
{
              
break;
          
}

jclass classID = getClassID(pEnv, className);

methodID = pEnv-&gt;GetStaticMethodID(classID, methodName, paramCode);
          
if (! methodID)
          
{
              
LOGD(&quot;Failed to find static method id of %s&quot;, methodName);
              
break;
          
}

methodinfo.classID = classID;
          
methodinfo.env = pEnv;
          
methodinfo.methodID = methodID;

bRet = true;
      
} while (0);

return bRet;
  
}

void callback(JavaVM\* jvm, const char\* value){
      
JniMethodInfo methodInfo;
      
if (! getStaticMethodInfo(jvm, methodInfo, &quot;com/jeidee/glooxforandroid/TestClient&quot;, &quot;testCallback&quot;, &quot;(Ljava/lang/String;)V&quot;))
      
{
          
return;
      
}

jstring stringArg = methodInfo.env-&gt;NewStringUTF(value);
      
methodInfo.env-&gt;CallStaticVoidMethod(methodInfo.classID, methodInfo.methodID, stringArg);
      
methodInfo.env-&gt;DeleteLocalRef(stringArg);
      
methodInfo.env-&gt;DeleteLocalRef(methodInfo.classID);
  
}

&amp;#8230;

callback(m_jvm, &quot;call testCallback()&quot;);

</code></pre>

<p>m_jvm은 JavaVM의 인스턴스이며 jni 로드시 다음과 같이 미리 구해놓을 수 있다.</p>

<pre><code class="language-cpp">  
static JavaVM* g_JVM;

jint JNI_OnLoad(JavaVM \*jvm, void \*reserved)
  
{
      
LOGD(&quot;JNI_OnLoad&quot;);
      
g_JVM = jvm;

JNIEnv* env;
      
if (jvm-&gt;GetEnv((void **)&amp;env, JNI\_VERSION\_1\_4) != JNI\_OK) {
          
LOGD(&quot;GETENVFAILEDONLOAD&quot;);
          
return -1;
      
}
      
return JNI\_VERSION\_1_4;
  
}

JNIEXPORT void JNICALL Java\_com\_jeidee\_glooxforandroid\_NativeCall_callbackTest (JNIEnv *env, jobject obj) {

&amp;#8230;

</code></pre>

<p>필요할 경우 콜백함수측의 java 클래스를 싱글턴으로 구현해 놓고 사용하고 Handler를 사용해 ui 쓰레드와 통신하면 된다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://blog.daum.net/_blog/BlogTypeView.do?blogid=0RBJ8&amp;articleno=8&amp;_bloghome_menu=recenttext">JNI에서 콜백함수 구현</a></li>
<li><a href="http://stackoverflow.com/questions/13377168/how-to-create-callbacks-between-android-code-and-native-code">How to create callbacks between android code and native code?</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/callback/">#callback</a>,
            
                <a href="https://jeidee.github.iotags/ndk/">#ndk</a>,
            
        
        <time class="post-date" datetime="2015-04-22T00:00:00Z">
            22 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/21/android-ndkec9790ec849c-socket-ec82acec9aa9/">Android NDK에서 socket 사용</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>AndroidMenifest.xml에 다음과 같이 추가한다.</p>

<pre><code>      
&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
      
&lt;application
  
</code></pre>

<p>주의할 것은 application 태그 위에 입력해야 한다는 것이다.</p>

<h2 id="출처">출처</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/6033581/using-socket-in-android-ndk">Using Socket() in Android NDK</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/socket/">#socket</a>,
            
        
        <time class="post-date" datetime="2015-04-21T00:00:00Z">
            21 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/21/android-native-ndkec9790ec849c-eba19ceab985ed9598eab8b0/">android native ndk에서 로깅하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>다음과 같이 선언하고 printf() 사용하듯이 사용하면 된다.</p>

<pre><code class="language-c">  
#include &lt;android/log.h&gt;

#define LOG_TAG &quot;someTag&quot;

#define LOGE(&amp;#8230;) \_\_android\_log\_print(ANDROID\_LOG\_ERROR,LOG\_TAG,\\_\_VA\_ARGS\__)
  
#define LOGW(&amp;#8230;) \_\_android\_log\_print(ANDROID\_LOG\_WARN,LOG\_TAG,\\_\_VA\_ARGS\__)
  
#define LOGD(&amp;#8230;) \_\_android\_log\_print(ANDROID\_LOG\_DEBUG,LOG\_TAG,\\_\_VA\_ARGS\__)
  
#define LOGI(&amp;#8230;) \_\_android\_log\_print(ANDROID\_LOG\_INFO,LOG\_TAG,\\_\_VA\_ARGS\__)
  
</code></pre>

<h2 id="출처">출처</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/12159316/logging-values-of-variables-in-android-native-ndk">Logging values of variables in Android native ndk</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/log/">#log</a>,
            
                <a href="https://jeidee.github.iotags/ndk/">#ndk</a>,
            
        
        <time class="post-date" datetime="2015-04-21T00:00:00Z">
            21 Apr 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/04/21/gloox-for-android/">gloox for android</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>gloox를 android에서 사용하기 위한 과정을 살펴보자.</p>

<h2 id="사전-준비-작업">사전 준비 작업</h2>

<p>다음과 같은 환경이 구축되어 있다고 가정한다.</p>

<ul>
<li>개발 환경 : Mac OS X Yosemite 10.10.3</li>
<li>Android Studio : 1.1.0

<ul>
<li>Android SDK 경로는 ~/Android/sdk로 변경</li>
</ul></li>
<li>NDK

<ul>
<li>~/Android/ndk에 복사하고 path 지정</li>
</ul></li>
</ul>

<h2 id="android-studio에-ndk-설정">Android Studio에 ndk 설정</h2>

<p>Preference &gt; External Tools에서 + 버튼을 클릭해 javah, ndk-build, ndk-build clean 도구를 추가한다.</p>

<p>1) javah</p>

<p><img src="http://localhost:8888/wordpress/wp-content/uploads/2015/04/ec8aa4ed81aceba6b0ec83b7-2015-04-21-ec98a4eca084-11-14-17.png" alt="javah_설정" /></p>

<p>2) ndk-build</p>

<p><img src="http://localhost:8888/wordpress/wp-content/uploads/2015/04/ec8aa4ed81aceba6b0ec83b7-2015-04-21-ec98a4eca084-11-15-40.png" alt="ndk-build" /></p>

<p>3) ndk-build clean</p>

<p><img src="http://localhost:8888/wordpress/wp-content/uploads/2015/04/ec8aa4ed81aceba6b0ec83b7-2015-04-21-ec98a4eca084-11-16-40.png" alt="ndk-build clean" /></p>

<h2 id="android-project-생성후-ndk-테스트">Android Project 생성후 NDK 테스트</h2>

<p>1) GlooxForAndroid 이름을 갖는 Android Project를 생성한다.</p>

<p>2) app/src/main/res/layout/activity_main.xml을 다음과 같이 수정한다.</p>

<pre><code>  
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
      
xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout\_width=&quot;match\_parent&quot;
      
android:layout\_height=&quot;match\_parent&quot; android:paddingLeft=&quot;@dimen/activity\_horizontal\_margin&quot;
      
android:paddingRight=&quot;@dimen/activity\_horizontal\_margin&quot;
      
android:paddingTop=&quot;@dimen/activity\_vertical\_margin&quot;
      
android:paddingBottom=&quot;@dimen/activity\_vertical\_margin&quot; tools:context=&quot;.MainActivity&quot;&gt;

&lt;Button
          
android:id=&quot;@+id/callBtn&quot;
          
android:layout\_width=&quot;wrap\_content&quot;
          
android:layout\_height=&quot;wrap\_content&quot;
          
android:text=&quot;Call JNI&quot; /&gt;

&lt;TextView
          
android:id=&quot;@+id/textVal&quot;
          
android:layout\_width=&quot;wrap\_content&quot;
          
android:layout\_height=&quot;wrap\_content&quot;
          
android:textSize=&quot;15pt&quot; /&gt;
  
&lt;/LinearLayout&gt;
  
</code></pre>

<p>Button 하나와 TextView 하나를 추가했다.</p>

<p>3) MainActivity.java를 다음과 같이 수정한다.</p>

<pre><code class="language-java">  
public class MainActivity extends ActionBarActivity {

private Button btn_;
      
private TextView textView_;

@Override
      
protected void onCreate(Bundle savedInstanceState) {
          
super.onCreate(savedInstanceState);
          
setContentView(R.layout.activity_main);

btn_ = (Button) findViewById(R.id.callBtn);
          
textView_ = (TextView) findViewById(R.id.textVal);

btn_.setOnClickListener(new View.OnClickListener() {
              
@Override
              
public void onClick(View v) {
                  
NativeCall nativeCall = new NativeCall();
                  
int ret = nativeCall.add(10, 20);
                  
String retStr = nativeCall.stringFromJNI();
                  
textView_.setText(retStr);
              
}
          
});
      
}
  
</code></pre>

<p>btn_을 클릭했을 때 NativeCall클래스의 함수를 호출한 결과를 textView_에 출력한다.</p>

<p>NativeCall클래스는 jni를 사용해 c/c++ 코드를 호출하게 된다.</p>

<p>4) NativeCall.java 클래스를 생성한다.</p>

<pre><code class="language-java">  
public class NativeCall {
      
static {
          
System.loadLibrary(&quot;my_lib&quot;);
      
}

public native int add(int i, int j);

public native String stringFromJNI();
  
}
  
</code></pre>

<p>Project 탐색기의 NativeCalll.java 클래스에서 마우스 우측 버튼으로 팝업메뉴를 출력한 후 NDK&gt;javah를 선택하면,</p>

<p>jni 디렉토리에 com_example_jeidee_glooxforandroid_NativerCall.h파일이 생성된다.</p>

<p>5) my_lib.cpp 파일을 생성한다.</p>

<pre><code class="language-cpp">  
#include &quot;com\_example\_jeidee\_ndktest\_NativeCall.h&quot;

JNIEXPORT jint JNICALL Java\_com\_jeidee\_glooxforandroid\_NativeCall_add
    
(JNIEnv *, jobject, jint i, jint j) {
      
return i + j;
    
}

JNIEXPORT jstring JNICALL Java\_com\_jeidee\_glooxforandroid\_NativeCall_stringFromJNI
    
(JNIEnv *env, jobject) {
      
return env-&gt;NewStringUTF(&quot;Hello JNI!!!!!&quot;);
    
}

</code></pre>

<p>6) ndk-build</p>

<p>app/src/build.gradle 파일을 열고 다음과 같이 ndk와 sourceSets.main 항목을 입력한다.</p>

<pre><code class="language-json">  
android {
      
compileSdkVersion 22
      
buildToolsVersion &quot;21.1.2&quot;

defaultConfig {
          
applicationId &quot;com.jeidee.glooxforandroid&quot;
          
minSdkVersion 15
          
targetSdkVersion 22
          
versionCode 1
          
versionName &quot;1.0&quot;

ndk {
              
moduleName &quot;my_lib&quot;
          
}

sourceSets.main {
              
jniLibs.srcDir 'src/main/libs'
              
jni.srcDirs = [] //important!!!! disable automatic ndk-build call
          
}
      
}

</code></pre>

<p>Project 탐색기의 NativeCall.java 클래스에서 마우스 우측 버튼으로 팝업메뉴를 출력한 후 NDK ndk-build를 선택하면,</p>

<p>빌드가 완료되고 src/main/libs/armeabi 디렉토리에 libmy_lib.so 공유 라이브러리 파일이 생성된다.</p>

<p>7) 빌드 후 테스트</p>

<p>안드로이드 디바이스를 연결후 Run &#8216;app&#8217;을 실행한다.</p>

<h2 id="openssl-for-android-빌드">openssl for android 빌드</h2>

<p>gloox는 openssl 라이브러리를 사용하기 때문에 openssl 소스를 빌드해 라이브러리를 얻어야 한다.</p>

<p>android를 위해 누군가 <a href="https://github.com/eighthave/openssl-android">github에 ndk-build를 위한 구성과 소스</a>를 올려 놓았으므로 다운로드 받아 사용하도록 한다.</p>

<p>git clone한 후 해당 디렉토리에서 ndk-build를 수행하면 된다.</p>

<p>성공적으로 빌드가 완료되면 libs/armeabi 디렉토리에 libssl.so와 libcrypto.so 파일이 생성된다.</p>

<p>해당 파일을 Android Project의 src/main/jni 하위에 libs 디렉토리를 생성하고 이 곳에 복사해 넣는다.</p>

<p>src/main/jni 하위에 openssl 디렉토리를 생성하고,</p>

<p>openssl의 include와 crypto 디렉토리를 복사해 넣는다.</p>

<h2 id="gloox-for-xcode-에서-소스-파일-복사해-오기">gloox for xcode 에서 소스 파일 복사해 오기</h2>

<p>이 글을 작성하는 현시점에서 gloox는 1.0.13버전이 최신버전이다.</p>

<p>해당 버전의 소스를 받아 ./configure &#8211;host=arm-linux를 수행한 후 소스파일을 복사해 사용해도 되지만,</p>

<p>[gloox for xcode]() 오픈소스를 받아 해당 프로젝트에 포함된 gloox 파일을 사용하도록 한다.</p>

<p>git clone한 후 Utils/gloox 디렉토리를 app/src/main/jni 디렉토리에 복사해 넣는다.</p>

<h2 id="android-mk-수정">Android.mk 수정</h2>

<p>1) openssl for android 빌드 결과물인 libcrypto와 libssl 라이브러리를 다음과 같이 Android.mk파일의 맨 위해 추가한다.</p>

<pre><code>  
LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)

LOCAL_MODULE := libcrypto

LOCAL\_SRC\_FILES := libs/libcrypto.so

include $(PREBUILT\_SHARED\_LIBRARY)

include $(CLEAR_VARS)

LOCAL_MODULE := libssl

LOCAL\_SRC\_FILES := libs/libssl.so

include $(PREBUILT\_SHARED\_LIBRARY)
  
</code></pre>

<p>2) gloox의 소스파일을 다음과 같이 추가한다.</p>

<pre><code>  
LOCAL\_SRC\_FILES :=
                      
my_lib.cpp
                      
gloox/adhoc.cpp
                      
gloox/amp.cpp
                      
gloox/annotations.cpp
                      
gloox/attention.cpp
                      
gloox/base64.cpp
                      
gloox/bookmarkstorage.cpp
                      
gloox/capabilities.cpp
                      
gloox/chatstate.cpp
                      
gloox/chatstatefilter.cpp
                      
gloox/client.cpp
                      
gloox/clientbase.cpp
                      
gloox/component.cpp
                      
gloox/compressiondefault.cpp
                      
gloox/compressionzlib.cpp
                      
gloox/connectionbosh.cpp
                      
gloox/connectionhttpproxy.cpp
                      
gloox/connectionsocks5proxy.cpp
                      
gloox/connectiontcpbase.cpp
                      
gloox/connectiontcpclient.cpp
                      
gloox/connectiontcpserver.cpp
                      
gloox/connectiontls.cpp
                      
gloox/connectiontlsserver.cpp
                      
gloox/dataform.cpp
                      
gloox/dataformfield.cpp
                      
gloox/dataformfieldcontainer.cpp
                      
gloox/dataformitem.cpp
                      
gloox/dataformreported.cpp
                      
gloox/delayeddelivery.cpp
                      
gloox/disco.cpp
                      
gloox/dns.cpp
                      
gloox/error.cpp
                      
gloox/eventdispatcher.cpp
                      
gloox/featureneg.cpp
                      
gloox/flexoff.cpp
                      
gloox/gloox.cpp
                      
gloox/gpgencrypted.cpp
                      
gloox/gpgsigned.cpp
                      
gloox/inbandbytestream.cpp
                      
gloox/instantmucroom.cpp
                      
gloox/iq.cpp
                      
gloox/jid.cpp
                      
gloox/lastactivity.cpp
                      
gloox/logsink.cpp
                      
gloox/md5.cpp
                      
gloox/message.cpp
                      
gloox/messageevent.cpp
                      
gloox/messageeventfilter.cpp
                      
gloox/messagefilter.cpp
                      
gloox/messagesession.cpp
                      
gloox/mucmessagesession.cpp
                      
gloox/mucroom.cpp
                      
gloox/mutex.cpp
                      
gloox/nickname.cpp
                      
gloox/nonsaslauth.cpp
                      
gloox/oob.cpp
                      
gloox/parser.cpp
                      
gloox/prep.cpp
                      
gloox/presence.cpp
                      
gloox/privacyitem.cpp
                      
gloox/privacymanager.cpp
                      
gloox/privatexml.cpp
                      
gloox/pubsubevent.cpp
                      
gloox/pubsubitem.cpp
                      
gloox/pubsubmanager.cpp
                      
gloox/receipt.cpp
                      
gloox/registration.cpp
                      
gloox/rosteritem.cpp
                      
gloox/rostermanager.cpp
                      
gloox/search.cpp
                      
gloox/sha.cpp
                      
gloox/shim.cpp
                      
gloox/simanager.cpp
                      
gloox/siprofileft.cpp
                      
gloox/socks5bytestream.cpp
                      
gloox/socks5bytestreammanager.cpp
                      
gloox/socks5bytestreamserver.cpp
                      
gloox/softwareversion.cpp
                      
gloox/stanza.cpp
                      
gloox/stanzaextensionfactory.cpp
                      
gloox/subscription.cpp
                      
gloox/tag.cpp
                      
gloox/tlsdefault.cpp
                      
gloox/tlsgnutlsbase.cpp
                      
gloox/tlsgnutlsclient.cpp
                      
gloox/tlsgnutlsclientanon.cpp
                      
gloox/tlsgnutlsserveranon.cpp
                      
gloox/tlsopensslbase.cpp
                      
gloox/tlsopensslclient.cpp
                      
gloox/tlsopensslserver.cpp
                      
gloox/tlsschannel.cpp
                      
gloox/uniquemucroom.cpp
                      
gloox/util.cpp
                      
gloox/vcard.cpp
                      
gloox/vcardmanager.cpp
                      
gloox/vcardupdate.cpp
                      
gloox/xhtmlim.cpp
  
</code></pre>

<p>3) openssl의 header files 경로를 다음과 같이 추가한다.</p>

<pre><code>  
LOCAL\_C\_INCLUDES := $(LOCAL_PATH)/openssl/include/
  
LOCAL\_C\_INCLUDES += $(LOCAL_PATH)/openssl/
  
</code></pre>

<p>4) openssl shared library와 zlib를 링크하기 위해 다음과 같이 추가하고 마무리한다.</p>

<pre><code>  
LOCAL\_SHARED\_LIBRARIES := libssl libcrypto

LOCAL_LDLIBS := -llog
  
LOCAL_LDLIBS += -lz

include $(BUILD\_SHARED\_LIBRARY)
  
</code></pre>

<p>LOCAL_LDLIBS += -lz 설정을 통해 zlib이 링크된다.</p>

<h2 id="application-mk-생성">Application.mk 생성</h2>

<p>c++ stl library 사용을 위해 jni 디렉토리 밑에 Application.mk파일을 생성하고 다음과 같이 입력한다.</p>

<pre><code>  
APP\_STL := c++\_static
  
</code></pre>

<h2 id="ndk-build">ndk-build</h2>

<p>1) error: &#8216;atoi&#8217; was not declared in this scope</p>

<p>.cpp 상단에 #include 를 추가해 준다.</p>

<p>2) RSA_generate_key() deprecate error</p>

<p>NativeCall.java 파일을 ndk-build하면 tlsopensslserver.cpp 컴파일 도중 에러가 발생하는데, RSA_generate_key()가 deprecate 되었기 때문에 다음 소스 코드를 추가해야 한다.</p>

<p>(참고 : <a href="http://aucd29.tistory.com/m/post/1101">with openssl porting guide</a>)</p>

<pre><code class="language-c">  
RSA *RSA\_generate\_key(int bits, unsigned long e_value,
           
void (\*callback)(int,int,void \*), void *cb_arg)
      
{
      
BN_GENCB cb;
      
int i;
      
RSA *rsa = RSA_new();
      
BIGNUM *e = BN_new();

if(!rsa || !e) goto err;

/* The problem is when building with 8, 16, or 32 BN_ULONG,
       
\* unsigned long can be larger \*/
      
for (i=0; i&lt;(int)sizeof(unsigned long)*8; i++)
          
{
          
if (e_value &amp; (1UL&lt;&lt;i))
              
if (BN\_set\_bit(e,i) == 0)
                  
goto err;
          
}

BN\_GENCB\_set\_old(&amp;cb, callback, cb\_arg);

if(RSA\_generate\_key_ex(rsa, bits, e, &amp;cb)) {
          
BN_free(e);
          
return rsa;
      
}
  
err:
      
if(e) BN_free(e);
      
if(rsa) RSA_free(rsa);
      
return 0;
      
}
  
</code></pre>

<h2 id="전체-프로젝트-다운로드">전체 프로젝트 다운로드</h2>

<p>github에 올려 놓았다.</p>

<p><a href="https://github.com/jeidee/GlooxForAndroid">https://github.com/jeidee/GlooxForAndroid</a></p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="https://github.com/eighthave/openssl-android">openssl-android</a></li>
<li><a href="http://herry.sinaapp.com/?p=31">gloox for android</a></li>
<li><a href="http://blog.y3xz.com/blog/2012/10/07/setting-up-an-arm-eabi-toolchain-on-mac-os-x">Setting Up an ARM EABI Toolchain on Mac OS X</a></li>
<li><a href="http://asos.tistory.com/13">Android에서 OpenSSL의 암호 알고리즘 사용하기 &#8211; 1편</a></li>
<li><a href="http://choizak.tistory.com/63">Android Project 에서 OpenSSL 사용하기</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/gloox/">#gloox</a>,
            
                <a href="https://jeidee.github.iotags/ndk/">#ndk</a>,
            
                <a href="https://jeidee.github.iotags/openssl/">#openssl</a>,
            
        
        <time class="post-date" datetime="2015-04-21T00:00:00Z">
            21 Apr 2015
        </time>
    </footer>
</article>

	

	<nav class="pagination" role="navigation">
	
	    <a class="newer-posts" href="/posts/page/10/">&larr; Newer Posts</a>
	
	<span class="page-number">Page 11 of 20</span>
	
	    <a class="older-posts" href="/posts/page/12/">Older Posts &rarr;</a>
	
</nav>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Erlang &amp; Go</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="https://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/syui/hugo-theme-air">hugo-theme-air</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://jeidee.github.iojs/jquery.js"></script>
    <script type="text/javascript" src="https://jeidee.github.iojs/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://jeidee.github.iojs/index.js"></script>

</body>
</html>

