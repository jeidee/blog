<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Erlang &middot;  Erlang &amp; Go" />
  	<meta property="og:site_name" content="Erlang &amp; Go" />
  	<meta property="og:url" content="https://jeidee.github.io/categories/erlang/" />
    
    
    <meta property="og:type" content="website" />
    

  <title>
     Erlang &middot;  Erlang &amp; Go
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://jeidee.github.ioimages/favicon.ico">
	  <link rel="apple-touch-icon" href="https://jeidee.github.ioimages/apple-touch-icon.png" />
    
    <link rel="stylesheet" type="text/css" href="https://jeidee.github.iocss/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://jeidee.github.ioindex.xml" rel="alternate" type="application/rss+xml" title="Erlang &amp; Go" />
      
      
        <link href="https://jeidee.github.io/categories/erlang/index.xml" rel="alternate" type="application/rss+xml" title="Erlang &middot; Erlang &amp; Go" />
      
    
    <meta name="generator" content="Hugo 0.31.1" />

    <link rel="canonical" href="https://jeidee.github.io/categories/erlang/" />

    
<div id="particles-js"></div>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="https://jeidee.github.iojs/particles.js"></script>   
</head>
<body class="nav-closed">

  


 <div class="site-wrapper">




	<header class="main-header tag-head no-cover">

    <nav class="main-nav overlay clearfix">
      
      
        
          <a class="menu-button icon-feed" href="https://jeidee.github.io/categories/erlang/index.xml">&nbsp;&nbsp;Subscribe</a>
        
      
    </nav>
    <div class="vertical">

        <div class="main-header-content inner">
            <h1 class="page-title">

              <a class="btn-bootstrap-2" href="#content">Erlang &amp; Go</a>
          </h1>
        </div>
</div>
    <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    

	<div class="extra-pagination inner">
    <nav class="pagination" role="navigation">
	
	<span class="page-number">Page 1 of 5</span>
	
	    <a class="older-posts" href="/categories/erlang/page/2/">Older Posts &rarr;</a>
	
</nav>

	</div>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/">couchbase cberl에 lcb_cntl 함수 추가</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p>cberl에 libcouchbase의 옵션을 설정하거나 조회할 수 있는 lcb_cntl 함수를 추가해 보자.</p>

<p>새로운 함수 추가를 위해 코맨드 상수를 추가해 준다.</p>

<p>cberl_nif.h를 열어 다음행을 추가해 준다.</p>

<pre><code class="language-cpp">  
#define CMD_CNTL 8
  
</code></pre>

<p>새로운 코맨드에 콜백함수를 등록해 주기 위해서 cberl_nif.c소스의 NIF(cberl_nif_new) 함수에 다음행을 추가해 준다.</p>

<p><a href="https://gist.github.com/jeidee/86967c348f64cee9b37c6bf41c207606">https://gist.github.com/jeidee/86967c348f64cee9b37c6bf41c207606</a></p>

<p>cntl 함수의 매개변수를 위한 구조체와 함수선언문을 cb.h에 다음과 같이 추가한다.</p>

<p><a href="https://gist.github.com/jeidee/430f7cea10bc95099cafb79e71407f42">https://gist.github.com/jeidee/430f7cea10bc95099cafb79e71407f42</a></p>

<p>cntl 함수 정의부를 cb.c에 다음과 같이 작성한다.</p>

<p><a href="https://gist.github.com/jeidee/07acab77aad96f32b4f79110ae202209">https://gist.github.com/jeidee/07acab77aad96f32b4f79110ae202209</a></p>

<p>이제 erlang 소스를 수정해 보자.</p>

<p>cntl 함수가 erlang에서 호출될 수 있도록 cberl.erl 소스파일에 다음과 같이 API를 작성한다.</p>

<p><a href="https://gist.github.com/jeidee/38adf8dc3e63723a9843ec3b3826cd76">https://gist.github.com/jeidee/38adf8dc3e63723a9843ec3b3826cd76</a></p>

<p>Mode값이 0일 경우 조회, 1일 경우 새로운 값으로 설정한다.</p>

<p>Cmd는 libcouchbase.h의 cntl.h파일에 정의되어 있다.</p>

<p>실제 cberl의 erlang worker process에서 cntl 메세지를 받아 처리하기 위해 다음과 같이 cberl_worker.erl 소스파일에 추가한다.</p>

<p><a href="https://gist.github.com/jeidee/18189bb8c7a91ffc356620f87910db63">https://gist.github.com/jeidee/18189bb8c7a91ffc356620f87910db63</a></p>

<p>여기 까지 포함된 소스는 github 리포지토리에 addcntl 브랜치로 작성해 놓았다.</p>

<p>erlang rebar 프로젝트에서 참조해 사용하기 위해서는 다음과 같이 rebar.config의 deps 섹션에 추가해야 한다.</p>

<pre><code>          
{cberl, &quot;.*&quot;, {git, &quot;https://github.com/jeidee/cberl.git&quot;, {branch, &quot;addcntl&quot;}}},
  
</code></pre>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/cberl/">#cberl</a>,
            
        
        <time class="post-date" datetime="2017-01-25T00:00:00Z">
            25 Jan 2017
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">couchbase cberl의IO Plugin을 libevent로 변경</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p>cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.</p>

<p>그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.</p>

<p>실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.</p>

<p>(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.)</p>

<pre><code>  
%% LCB\_CNTL\_CONLOGGER_LEVEL
  
cberl:cntl(?POOL_ID, 1, 16#29, 5). 

COUCHBASE: too many FDs. Cannot have socket FD_SETSIZE. Use other I/O plugin
  
</code></pre>

<p><a href="https://developer.couchbase.com/documentation/server/current/sdk/c/start-using-sdk.html">https://developer.couchbase.com/documentation/server/current/sdk/c/start-using-sdk.html</a></p>

<p>해당 문서에는 다음과 같이 적시되어 있다.</p>

<blockquote>
<p>You should install the libcouchbase2-libevent plugin in case your application will use more than 1024 file descriptors. The default select() based event loop only supports 1024 file descriptors.</p>
</blockquote>

<p>libevent로 변경하기 위해서는 cberl의 cb.c 소스를 다음과 같이 수정해야 한다.</p>

<p><a href="https://gist.github.com/jeidee/62ed9a02b844c4e6efc587ff5ca5d973">https://gist.github.com/jeidee/62ed9a02b844c4e6efc587ff5ca5d973</a></p>

<p>그리고 실행될 erlang application이 있는 서버에 libcouchbase2-libevent 플러그인이 설치되어 있어야 한다.</p>

<p>centos 6에서는 다음과 같이 설치할 수 있다.</p>

<pre><code>  
\# wget http://packages.couchbase.com/releases/couchbase-release/couchbase-release-1.0-0-x86_64.rpm
  
\# rpm -i couchbase-release-1.0-0-x86_64.rpm
  
\# yum install libcouchbase2-libevent
  
</code></pre>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/45/">#45</a>,
            
                <a href="https://jeidee.github.iotags/cberl/">#cberl</a>,
            
        
        <time class="post-date" datetime="2017-01-25T00:00:00Z">
            25 Jan 2017
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p>Makefile.in을 열어 skip_deps=true 부분을 찾아 skip_deps=false로 수정하면 된다.</p>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        
        <time class="post-date" datetime="2017-01-25T00:00:00Z">
            25 Jan 2017
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2016/06/28/tsungec9d84-ec82acec9aa9ed95b4-ejabberd-ed858cec8aa4ed8ab8ed9598eab8b0/">tsung을 사용해 ejabberd 테스트하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<h2 id="테스트-환경">테스트 환경</h2>

<ul>
<li>ejabber node 1대, tsung node 1대, dabase node 1대</li>
<li>ulimit -n 100000</li>
</ul>

<h2 id="tsung-xml">tsung.xml</h2>

<p><a href="https://gist.github.com/jeidee/ae4cb98e609f405d5ce6b60a4b53f0fe">https://gist.github.com/jeidee/ae4cb98e609f405d5ce6b60a4b53f0fe</a></p>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        
        <time class="post-date" datetime="2016-06-28T00:00:00Z">
            28 Jun 2016
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2016/05/16/erlang-ecbd94eb94a9-ed919ceca480eab3bc-eab080ec9db4eb939ceb9dbcec9db8/">Erlang 코딩 표준과 가이드라인</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<h2 id="참고원문">참고원문</h2>

<p><a href="https://github.com/inaka/erlang_guidelines">https://github.com/inaka/erlang_guidelines</a></p>

<p>자세한 내용은 원문을 참고하세요.</p>

<h2 id="소스-코드-레이아웃">소스 코드 레이아웃</h2>

<ul>
<li>탭은 공백문자 2개로 표현하며 탭문자를 사용하지 않는다. <em>Examples</em>: <a href="src/indent.erl">indent</a></li>
<li>연산자는 공백으로 감싼다. <em>Examples</em>: <a href="src/spaces.erl">spaces</a></li>
<li>줄의 끝에서 Whitespace를 제거한다. <em>Examples</em>: <a href="src/trailing_whitespace.erl">trailing_whitespace</a></li>
<li>한 줄에 작성하는 문자는 80 컬럼을 넘지 않는다. <em>Examples</em>: <a href="src/col_width.erl">col_width</a></li>
<li>기존 코드의 스타일을 준수한다. <em>Examples</em>: <a href="src/existing_style.erl">existing_style</a></li>
<li>깊은 중첩을 피한다. <em>Examples</em>: <a href="src/nesting.erl">nesting</a></li>

<li><p>case 표현식보다는 함수 패턴 매치를 사용한다.</p>

<p><em>Examples</em>: <a href="src/smaller_functions.erl">smaller_functions</a></p></li>

<li><p>public(exported)/private(unexported) 함수를 논리적으로 그룹짓는다. <em>Examples</em>: <a href="src/grouping_functions">grouping_functions</a></p></li>

<li><p>사용자정의 타입은 소스파일의 상단에 모아 놓는다. <em>Examples</em>: <a href="src/type_placement.erl">type_placement</a></p></li>

<li><p>모든 기능을 하는 신의 모듈(슈퍼모듈)을 만들지 않는다. <em>Examples</em>: <a href="src/god.erl">god</a></p></li>

<li><p>유닛 테스트는 간단하게(가능한 짧고 assert문은 한 개 또는 두 개만) 만든다. <em>Examples</em>: <a href="src/test_SUITE.erl">test_SUITE</a></p></li>

<li><p>DRY(Don&#8217;t repeat yourself) 원칙을 준수한다.(중복코드 제거) <em>Examples</em>: <a href="src/dry.erl">dry</a></p></li>

<li><p>동적 호출을 지양한다.</p>

<p><em>Examples</em>: <a href="src/dyn_calls.erl">dyn_calls</a></p></li>

<li><p>기능적으로 유사한 모듈은 서브디렉토리를 통해 그룹짓는다.(선택) Emakefile 참조할 것!</p></li>

<li><p>스파게티 코드(가독성을 헤치는 복잡한 코드)를 작성하지 마라. <em>Examples</em>: <a href="src/spaghetti.erl">spaghetti</a></p></li>
</ul>

<h2 id="구문">구문</h2>

<ul>
<li>if 구문을 사용하지 말고 함수 패턴 매치를 사용해라. <em>Examples</em>: <a href="src/no_if.erl">no_if</a></li>
<li>중첩 try&#8230;catch 절을 사용하지 마라. <em>Examples</em>: <a href="src/nested_try_catch.erl">nested_try_catch</a></li>
</ul>

<h2 id="네이밍">네이밍</h2>

<ul>
<li>네이밍 컨셉은 일관성을 유지해라. <em>Examples</em>: <a href="src/consistency.erl">consistency</a></li>
<li>OTP 모듈의 상태(State)는 state 레코드(-type state():: #state{})를 정의해서 사용한다. <em>Examples</em>: <a href="src/state">state</a></li>
<li>_Ignored(사용하지 않아도 컴파일 에러에서 무시됨) 변수를 사용하지 않는다. *Examples*: <a href="src/ignored_vars.erl">ignored_vars</a></li>
<li>흐름제어를 위한 boolean 매개변수를 사용하지 않는다. <em>Examples</em>: <a href="src/boolean_params.erl">boolean_params</a></li>
<li>모듈의 네이밍은 동일한 규칙을 적용한다. <em>Examples</em>: <a href="src/naming_modules">naming_modules</a></li>
<li>특수한 문자열 상수는 소문자 형식의 atom을 사용한다. <em>Examples</em>: <a href="src/atoms.erl">atoms</a></li>
<li>함수이름은 단어사이를 _로 구분한 소문자만으로 작명한다. *Examples*: <a href="src/function_names.erl">function_names</a></li>
<li>변수이름은 CamelCase를 사용하며 단어를 구분하기 위해 _를 사용하지 않는다. *Examples*: <a href="src/variable_names.erl">variable_names</a></li>
</ul>

<h2 id="문자열">문자열</h2>

<ul>
<li>문자열 연결을 할 때 ++ 사용하는 대신, iolists를 사용해라. <em>Examples</em>: <a href="src/iolists.erl">iolists</a></li>
</ul>

<h2 id="매크로">매크로</h2>

<ul>
<li>이미 정의된(?MODULE, ?MODULE_STRING, ?LINE&#8230;) 매크로 이외의 매크로를 사용하지 마라. <em>Examples</em>: <a href="src/macros.erl">macros</a></li>
<li>매크로는 대문자만으로 네이밍한다. <em>Examples</em>: <a href="src/macro_names.erl">macro_names</a></li>
<li>매크로 이름에 함수나 모듈의 이름을 사용하지 않는다. <em>Examples</em>: <a href="src/macro_mod_names.erl">macro_mod_names</a></li>
</ul>

<h2 id="레코드">레코드</h2>

<ul>
<li>레코드 이름은 소문자로만 작성하며 단어사이는 _로 구분한다. *Examples*: <a href="src/record_names.erl">record_names</a></li>
<li>레코드는 함수 정의부보다 항상 먼저 정의되어야 한다. <em>Examples</em>: <a href="src/record_placement.erl">record_placement</a></li>
<li>레코드를 .hrl 파일을 통해 다른 모듈과 공유하지 않는다. 필요하다면 opaque 키워드를 통해 다른 모듈로 타입을 export할 수 있다. <em>Examples</em>: <a href="src/record_sharing.erl">record_sharing</a></li>
<li>spec을 정의할 때 레코드를 사용하는 대신 타입을 사용해야 한다. <em>Examples</em>: <a href="src/record_spec.erl">record_spec</a></li>
<li>레코드의 필드는 항상 타입 정의를 추가해서 작성한다. <em>Examples</em>: <a href="src/record_types.erl">record_types</a></li>
</ul>

<h2 id="기타">기타</h2>

<ul>
<li>함수의 spec을 항상 작성한다. <em>Examples</em>: <a href="src/specs.erl">specs</a></li>
<li>erlang R14 이전의 컴파일러를 지원하기 위해 behaviour_info/1 대신 -callback 지시자를 사용해라. <em>Examples</em>: <a href="src/callbacks">callbacks</a></li>

<li><p>중첩된 헤더파일 포함 구문을 사용하지 마라.</p>

<p><em>Examples</em>: <a href="include/nested.hrl">nested</a></p></li>

<li><p>헤더파일에 -type 지시자를 사용하지 않는다.</p>

<p><em>Examples</em>: <a href="src/types.erl">types</a></p></li>

<li><p>-import 지시자를 사용하지 마라. <em>Examples</em>: <a href="src/import.erl">import</a></p></li>

<li><p>-export_all 지시자를 사용하지 마라.</p>

<p><em>Examples</em>: <a href="src/export_all.erl">export_all</a></p></li>

<li><p>디버깅을 위한 호출을 사용하지 마라.(특히 로그를 남기기 위한 코드는 성능에 나쁜 영향을 끼친다.) <em>Examples</em>: <a href="src/debug_calls.erl">debug_calls</a></p></li>
</ul>

<h2 id="도구">도구</h2>

<ul>
<li>의존성 모듈을 포함할 때는, master 대신 특정 tag나 커밋버전을 명시한다. <em>Examples</em>:</li>
<li><a href="priv/Makefile">erlang.mk</a></li>
<li><a href="priv/rebar.config">rebar.config</a></li>
<li>에러가 발생하면 로그로 출력해라. <em>Examples</em>: <a href="src/loud_errors.erl">loud_errors</a></li>

<li><p>다음과 같이 적합한 로그레벨을 사용해라.</p>

<p>** debug: 매우 저수준의 정보를 출력</p>

<p>** info: 시스템의 약간 상세한 정보를 출력한다. 일반적이지만 항상 발생하지 않으며 받아드릴 수 있는 수준이어야 한다.</p>

<p>** notice: 알릴 가치가 있는 정보(supervisor, gen_server등의 시작, 종료)를 출력할 때 사용한다.</p>

<p>** warning: 시스템이 계속 동작하는데 영향을 주진 않지만 정상적인 경우가 아닌 에러를 처리할 때 사용한다.</p>

<p>** error: 무언가 나쁘고 예상치 못한 상황이 발생할 때, 보통 예외나 에러가 발생할 때 사용하며 스택트레이스를 함께 출력해야 한다.</p>

<p>** critical: 시스템 크래시 상황에 사용한다.</p></li>

<li><p>의존성 모듈을 명시할 때, https 이외의 것은 사용하지 않는다. <em>Examples</em>: <a href="src/dependency_protocol/dep_protocol.makefile">makefile example</a> <a href="src/dependency_protocol/dep_protocol.config">rebar example</a></p></li>
</ul>

<h2 id="제안-및-훌륭한-아이디어">제안 및 훌륭한 아이디어</h2>

<ul>
<li>변수는 _대신 CamelCase를 사용한다. *Examples*: <a href="src/camel_case.erl">camel_case</a></li>
<li>의미를 알 수 있는 짧은 변수명을 사용한다. <em>Examples</em>: <a href="src/var_names.erl">var_names</a></li>
<li>모듈 주석은 %%%, 함수 주석은 %%, 문장 코드 주석은 %를 사용한다. <em>Examples</em>: <a href="src/comment_levels.erl">comment_levels</a></li>
<li>함수는 가능한 짧게 유지한다. <em>Examples</em>: <a href="src/small_funs.erl">small_funs</a></li>
<li>재사용 가능한 캡슐화된 코드를 위해 behaviour를 사용한다. <em>Examples</em>: <a href="src/behavior.erl">behavior</a></li>
<li>방어적인 프로그래밍은 클라이언트 코드에서 작성해라. (유효성 체크는 코드의 바깥에서) <em>Examples</em>: <a href="src/validations.erl">validations</a></li>
<li>빈 리스트 검사를 위해 length/1를 사용하는 대신 함수 패턴 매치를 사용해 빈리스트와 매치해서 사용해라. <em>Examples</em>: <a href="src/pattern_matching.erl">pattern matching</a></li>
<li>독립적인 애플리케이션은 옮겨 작성하는 것을 고려해라.(가능하면 오픈소스 형태로&#8230;)</li>
<li>라이브러리는 facade 패턴을 사용해라. <em>Examples</em>: <a href="https://github.com/inaka/kafkerl/blob/master/src/kafkerl.erl">kafkerl</a></li>
<li>export된 함수에서 사용하는 사용자 정의 타입은 해당 모듈에서 정의해서 함께 export하도록 한다. <em>Examples</em>: <a href="src/data_types.erl">data_types</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        
        <time class="post-date" datetime="2016-05-16T00:00:00Z">
            16 May 2016
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2016/05/16/erlang-ed9484eba19ceab7b8eb9e98ebb08d-eab79cecb999eab3bc-ecbba8ebb2a4ec8598/">Erlang 프로그래밍 규칙과 컨벤션</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<h2 id="원문">원문</h2>

<p><a href="http://www.erlang.se/doc/programming_rules.shtml">http://www.erlang.se/doc/programming_rules.shtml</a></p>

<p>원문을 간략히 요약/정리해 보았습니다.</p>

<h2 id="sw-공학-원리">SW 공학 원리</h2>

<ul>
<li>하나의 모듈에서는 가능한 적은 수의 함수를 export한다.</li>
<li>모듈간 의존성은 가능한 줄이도록 한다.</li>
<li>공통 코드는 라이브러리로 작성한다.</li>

<li><p>dirty하거나 tricky한 코드는 분리된 모듈로 작성한다.</p>

<p>** 예를 들면, process의 사전을 사용하거나, 이상한 목적으로 erlang:process_info/1를 사용하거나&#8230;하는 등의</p></li>

<li><p>함수호출자가 반환된 결과로 무엇을 할 것인지 가정해서 작성하지 말고, 결과를 돌려주기만 해라.</p></li>

<li><p>중복 코드가 발생할 것 같다면 함수를 사용해서 중복 코드를 피하라.</p></li>

<li><p>Top-down 방식(개괄에서 상세로)으로 코드를 작성해라.</p></li>

<li><p>항상 코드를 최적화해서 작성하려고 하지 마라. 필요할 때 필요한 코드만 최적화해라.</p></li>

<li><p>일관성을 유지해서 예측 가능한(least astonishment) 코드를 작성해라.</p></li>

<li><p>side effect를 제거하도록 노력해라.</p></li>

<li><p>private data의 자료구조가 모듈 밖으로 누출(leak)되지 않도록 해라.</p></li>

<li><p>가능한 결정적인 코드(매 실행 결과가 동일)를 작성하도록 한다.</p></li>

<li><p>방어적으로 프로그래밍하지 않는다.(validation은 클라이언트 코드에서&#8230;)</p></li>

<li><p>장치 드라이버를 위한 하드웨어 인터페이스는 분리한다.</p></li>

<li><p>초기화와 해제(예를 들어 파일열고 닫기)를 위한 기능은 같은 함수에서 처리한다.</p></li>
</ul>

<h2 id="에러-처리">에러 처리</h2>

<ul>
<li>에러 처리 코드와 정상 처리 코드는 분리한다.</li>
<li>커널 에러를 식별한다.</li>
</ul>

<h2 id="프로세스-서버-메세지">프로세스, 서버, 메세지</h2>

<ul>
<li>하나의 모듈에서는 하나의 프로세스만 구현한다.</li>
<li>시스템 구조를 위해 프로세스를 사용할 수 있지만 함수 호출로 대신할 수 있는 경우 프로세스와 메세지 전달은 사용하지 않는다.</li>
<li>이름이 등록된 프로세스를 사용한다.</li>
<li>실세계에서 존재하는 동시성 작업당 하나의 병렬 프로세스를 할당하도록 한다.</li>
<li>프로세스에는 오직 하나의 역할(role)만 할당한다.</li>
<li>가능하다면 서버와 프로토콜 핸들러를 위해서 제네릭 함수를 사용하도록 한다.</li>
<li>메세지는 태그를 붙여 전달한다.(예를 들어 {execute, Mod, Funcs, Args} 등의 형식으로)</li>
<li>명시되지 않은 메세지는 버린다.</li>
<li>서버는 꼬리재귀(tail-recursive)를 사용해 작성한다.</li>
<li>메세지를 전달할 때 직접 전달하지말고, 인터페이스 함수를 사용한다.</li>
<li>타임아웃 : receive 구문에서 after를 사용할 때는 주의해야 한다.</li>
<li>exit 시그널 처리(Trapping exits) : 가능한 적은 프로세스에서 exit 시그널이 처리되어야 한다.</li>
</ul>

<h2 id="다양한-erlang-컨벤션">다양한 Erlang 컨벤션</h2>

<ul>
<li>자료구조는 레코드를 사용한다.</li>
<li>레코드를 사용할 때는 selector(#person{name = Name})와 constructor(P = #person{name= &#8220;Joe&#8221;})를 사용한다.</li>
<li>반환값은 tag된 값({value, Value})을 사용한다.</li>
<li>catch와 throw는 극도로 주의해서 사용해라. 가능하면 사용하지 마라.</li>
<li>process dictionary(get/1, put/1)는 극도로 주의해서 사용해라. 가능하면 사용하지 마라.</li>
<li>-import 지시자를 사용하지 않는다.</li>

<li><p>함수 export는 다음의 경우에만 사용해라</p>

<p>** 모듈의 사용자 인터페이스</p>

<p>** 다른 모듈을 위한 인퍼테이스 함수</p>

<p>** apply, spawn등에서 불리는 함수지만 동일 모듈에서만 사용할 때</p></li>
</ul>

<h2 id="명시적인-어휘와-스타일-컨벤션">명시적인 어휘와 스타일 컨벤션</h2>

<ul>
<li>깊은 중첩 코드를 작성하지 않는다.</li>
<li>매우 큰 모듈을 작성하지 않는다.(400줄 이상의 모듈)</li>
<li>매우 큰 함수를 작성하지 않는다.(15줄에서 20줄)</li>
<li>매우 긴 줄의 코드를 작성하지 않는다.(80컬럼 이상)</li>
<li>변수명은 CamelCase를 사용하며 _로 단어를 구분하지 않는다.</li>
<li>함수명은 소문자로만 작성하며 단어사이는 _로 구분한다.</li>
<li>모듈명은 소문자로만 작성하며 단어사이는 _로 구분한다. 모듈 접두어는 동일한 규칙으로 적용한다.</li>
<li>일관성있는 방법으로 코드를 포매팅한다.(들여쓰기, 공백문자 사용등)</li>
</ul>

<h2 id="코드-문서화">코드 문서화</h2>

<ul>
<li>코드 속성</li>
</ul>

<pre><code>  
-revision('Revision: 1.14 ').
  
-created('Date: 1995/01/01 11:21:11 ').
  
-created_by('eklas@erlang').
  
-modified('Date: 1995/01/05 13:04:07 ').
  
-modified_by('mbj@erlang').
  
</code></pre>

<ul>
<li>코드 명세에 대한 참조를 제공한다.</li>
<li>모든 에러에 대해 문서화한다.</li>
<li>모든 메세지에 대해 문서화한다.</li>
<li>모듈 주석은 %%%, 함수 주석은 %%, 코드 주석은 %</li>
<li>함수 주석</li>
</ul>

<pre><code>  
%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
%% Function: get\_server\_statistics/2
  
%% Purpose: Get various information from a process.
  
%% Args: Option is normal|all.
  
%% Returns: A list of {Key, Value}
  
%% or {error, Reason} (if the process is dead)
  
%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
get\_server\_statistics(Option, Pid) when pid(Pid) -&gt;
    
&amp;#8230;&amp;#8230;
  
</code></pre>

<ul>
<li>자료 구조 주석</li>
</ul>

<pre><code>  
%% File: my\_data\_structures.h

%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%% Data Type: person
  
%% where:
  
%% name: A string (default is undefined).
  
%% age: An integer (default is undefined).
  
%% phone: A list of integers (default is []).
  
%% dict: A dictionary containing various information about the person.
  
%% A {Key, Value} list (default is the empty list).
  
%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
-record(person, {name, age, phone = [], dict = []}).
  
</code></pre>

<ul>
<li>파일 헤더 &#8211; 카피라이트</li>
</ul>

<pre><code>  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Copyright Ericsson Telecom AB 1996
  
%%%
  
%%% All rights reserved. No part of this computer programs(s) may be
  
%%% used, reproduced,stored in any retrieval system, or transmitted,
  
%%% in any form or by any means, electronic, mechanical, photocopying,
  
%%% recording, or otherwise without prior written permission of
  
%%% Ericsson Telecom AB.
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
</code></pre>

<ul>
<li>파일 헤더 &#8211; 리비전 히스토리</li>
</ul>

<pre><code>  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Revision History
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Rev PA1 Date 960230 Author Fred Bloggs (ETXXXXX)
  
%%% Intitial pre release. Functions for adding and deleting foobars
  
%%% are incomplete
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Rev A Date 960230 Author Johanna Johansson (ETXYYY)
  
%%% Added functions for adding and deleting foobars and changed
  
%%% data structures of foobars to allow for the needs of the Baz
  
%%% signalling system
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
</code></pre>

<ul>
<li>파일 헤더 &#8211; 디스크립션</li>
</ul>

<pre><code>  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Description module foobar\_data\_manipulation
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Foobars are the basic elements in the Baz signalling system. The
  
%%% functions below are for manipulating that data of foobars and for
  
%%% etc etc etc
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% Exports
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
%%% create_foobar(Parent, Type)
  
%%% returns a new foobar object
  
%%% etc etc etc
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;
  
</code></pre>

<ul>
<li>오래된 코드에는 주석을 달지 말고 제거해라</li>
<li>소스 코드 버전 시스템을 사용해라(SVN, GIT)</li>
</ul>

<h2 id="가장-일반적인-실수들">가장 일반적인 실수들</h2>

<ul>
<li>긴 함수</li>
<li>깊은 중첩</li>
<li>잘못된 타입을 사용하는 함수</li>
<li>어떤 함수인지 알 수 없는 함수명</li>
<li>어떤 변수인지 알 수 없는 변수명</li>
<li>불필요한 곳에서 사용하는 프로세스</li>
<li>잘못된 자료구조 선택</li>
<li>잘못된 주석, 또는 전혀 주석이 없는 코드</li>
<li>들여쓰기되지 않은 코드</li>
<li>put/get을 사용하는 코드</li>
<li>알 수 없는 메세지를 제어하지 않는 코드</li>
</ul>

<h2 id="필수-문서들">필수 문서들</h2>

<ul>
<li><p>모듈과 모듈이 포함하는 모든 export 함수에 대해 다음 설명이 문서화 되어야 한다.</p>

<p>** 함수 매개변수의 의미와 자료구조 설명</p>

<p>** 함수 반환 값의 의미와 자료구조 설명</p>

<p>** 함수의 목적</p>

<p>** exit/1 함수를 호출할 때, 실패와 종료를 야기한 이유</p></li>

<li><p>프로세스간 주고 받는 모든 메세지들에 대한 포맷이 문서화 되어야 한다.</p></li>

<li><p>시스템의 모든 등록된 서버의 인터페이스와 그들의 목적이 문서화 되어야 한다.</p></li>

<li><p>모든 에러메세지는 문서화 되어야 한다.</p></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        
        <time class="post-date" datetime="2016-05-16T00:00:00Z">
            16 May 2016
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2016/02/15/cowboyec9790ec849c-sseeba5bc-ec82acec9aa9ed959c-ec9bb9ec849cebb284-push-eab5aced9884ed9598eab8b0/">cowboy에서 SSE를 사용한 웹서버 push 구현하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p><a href="https://erlnote.wordpress.com/2016/02/03/ejabberd%EC%99%80-cowboy-%EC%97%B0%EB%8F%99/">ejabberd에 cowboy를 연동</a>했다고 가정한다.</p>

<p>Front-end는 AngularJS를 사용한다.</p>

<ul>
<li><a href="https://www.google.co.kr/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#lr=lang_ko&amp;newwindow=1&amp;tbs=lr:lang_1ko&amp;q=server+sent+event">SSE(Server Sent Event)참고</a></li>
</ul>

<p>클라이언트에서 다음과 같이 EventSource객체를 생성한 후 서버 이벤트를 위한 이벤트리스닝을 시작한다.</p>

<p><a href="https://gist.github.com/jeidee/a135060aef54b48bae1d">https://gist.github.com/jeidee/a135060aef54b48bae1d</a></p>

<p>서버에서는 다음과 같이 cowboy_req:chunked_reply/3 함수를 사용해 content-type이 text/event-stream인 응답을 보내고 {cowboy_loop, _, _}를 반환한다.</p>

<p>일반적으로 하나의 클라이언트 요청(http request)당 하나의 erlang process를 생성하며, cowboy_req:reply/4 함수를 사용해 reponse를 보내고 {ok, _, _}를 반환하면 해당 erlang process를 종료한다.</p>

<p>하지만 Server Sent Event를 위해 {cowboy_loop, _, _}를 반환하면 해당 클라이언트의 요청(Request) 객체를 erlang process에 상태로 유지하며,</p>

<p>이 process에 메시지를 보내면(erlang message, Pid ! Message.의 방식으로) cowboy_req:chunk/2 함수를 사용해 해당 클라이언트(erlang process가 유지하고 있는 Request객체를 사요해서)에 지속해서 데이터를 보낼 수 있다.</p>

<p>이 때 cowboy_req:cunk/2에 실어 보내는 Chunk는 문자열포맷으로 &#8220;id:~p\ndata:~s\n\n&#8221;와 같은 구조를 갖고 있어야 한다. data필드는 필수이며, 보통 json 포맷 문자열을 인코딩해 사용한다.</p>

<p>좀 더 자세한 내용은 SSE 문서를 참고하도록 한다.</p>

<p><a href="https://gist.github.com/jeidee/71626206d48bf9f1016a">https://gist.github.com/jeidee/71626206d48bf9f1016a</a></p>

<p>mod_webadmin_monitor 모듈은 gen_server를 구현한 서버 모듈이며,</p>

<p>mod_webadmin_api_handler에서 eventsource를 시작하면 monitor 모듈에 클라이언트 요청 erlang process id를 전달해 추후 서버에서 클라이언트로 푸시할 데이터가 있을 때 PID를 사용해 클라이언트에 데이터를 푸시할 수 있다.</p>

<p><a href="https://gist.github.com/jeidee/e6d89835f7a1706051bf">https://gist.github.com/jeidee/e6d89835f7a1706051bf</a></p>

<p>클라이언트 프로세스가 종료된 경우 해당 PID를 정리해야 하므로 send_data/2 함수에서 해당 Pid가 살아있는지 체크하는 코드가 추가되어 있다.</p>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/cowboy/">#cowboy</a>,
            
                <a href="https://jeidee.github.iotags/sse/">#SSE</a>,
            
        
        <time class="post-date" datetime="2016-02-15T00:00:00Z">
            15 Feb 2016
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2016/01/15/couchbase-cberl-ec82acec9aa9ed95b4ec849c-view-eca1b0ed9a8cec8b9c-eca3bcec9d98ec82aced95ad/">couchbase cberl 사용해서 view 조회시 주의사항</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p>couchbase의 view 조회시 데이터의 최신 본을 얻지 못할 수도 있다.</p>

<p>이러한 이유는 속도의 향상을 위해 stale옵션의 기본값이 true로 설정되어 있어서 그런데, 명시적으로 stale옵션을 false로 지정해야 최신 데이터가 적용된 view를 구할 수 있다.</p>

<p>cberl:view()함수를 사용할 때, stale옵션을 false로 지정하는 방법은 다음과 같다.</p>

<p><a href="https://gist.github.com/jeidee/79e08693d3c6be338e31">https://gist.github.com/jeidee/79e08693d3c6be338e31</a></p>

<p>Args에 {stale, false}를 추가하면 된다.</p>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/cberl/">#cberl</a>,
            
        
        <time class="post-date" datetime="2016-01-15T00:00:00Z">
            15 Jan 2016
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/11/13/erlang-applicationec9790ec849c-protocol-buffer-ec82acec9aa9ed9598eab8b0/">erlang application에서 protocol buffer 사용하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p>이번 역시, <a href="https://erlnote.wordpress.com/2015/11/06/erlang-rebar%EC%9D%98-project-template%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-application-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0/">rebar를 사용해 프로젝트를 생성</a>했다고 가정한다.</p>

<p>basho의 protobuffs 라이브러리를 추가해 보도록 하자.</p>

<h2 id="rebar-config-수정">rebar.config 수정</h2>

<p><a href="https://erlnote.wordpress.com/2015/11/11/erlang-application%EC%97%90-lager%EB%A1%9C%EA%B1%B0-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0/">이전 포스트</a>를 참고해서 기본 작업(sub_dirs 추가 등)은 완료했다고 가정한다.</p>

<pre><code>  
{deps, [
  
{'lager', &quot;.*&quot;, {git, &quot;https://github.com/basho/lager&quot;, &quot;&quot;}},
  
{protobuffs, &quot;.*&quot;, {git, &quot;git://github.com/basho/erlang_protobuffs.git&quot;, {branch, &quot;master&quot;}}}
  
]}.
  
</code></pre>

<ul>
<li>deps에 protobuffs, &#8230; 행을 복사해 넣는다.</li>
</ul>

<h2 id="xxx-proto-파일-생성">xxx.proto 파일 생성</h2>

<p>프로토콜을 정의한 *.proto파일을 생성한다.</p>

<p>예를 들면 다음과 같은 simple.proto파일을 src 디렉토리 밑에 추가한다.</p>

<pre><code>  
package simple;

message Person {
  
required string name = 1;
  
required string address = 2;
  
required string phone_number = 3;
  
required int32 age = 4;
  
optional Location location = 5;
  
}

message Location
  
{
  
required string region = 1;
  
required string country = 2;
  
}
  
</code></pre>

<p>make로 컴파일하고 나면 rebar가 .proto파일을 자동으로 인식해 include 디렉토리(src와 동일 레벨)를 생성하고, simple_pb.hrl파일을 생성한다.</p>

<p>simple_pb.erl파일은 컴파일 완료 후 ebin 디렉토리에 simple_pb.beam 파일을 생성 후 자동으로 삭제된다.</p>

<h2 id="테스트">테스트</h2>

<p>make console 명령으로 console에서 어플리케이션을 시작한다.</p>

<p>erl쉘이 출력되면 다음과 같이 encoding, decoding을 할 수 있다.</p>

<ul>
<li>simple_pb.hrl에는 record가 정의되어 있지만 쉘에서는 rd()명령어로 레코드를 정의후 테스트할 수 있다.</li>
</ul>

<pre><code>  
&gt; rd(location, {region, country}).
  
&gt; L1 = simple\_pb:encode\_location(#region{region=&quot;Korea&quot;, country=&quot;Seoul&quot;}).
  
&gt; L2 = list\_to\_binary(L1).
  
&gt; simple\_pb:decode\_location(L2).
  
</code></pre>

<h2 id="참고">참고</h2>

<p>좀 더 자세한 내용은 다음 링크를 참고한다.</p>

<ul>
<li><a href="https://github.com/basho/erlang_protobuffs">erlang_protobuffs</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/google-protocol-buffer/">#google protocol buffer</a>,
            
                <a href="https://jeidee.github.iotags/gpb/">#gpb</a>,
            
                <a href="https://jeidee.github.iotags/proto/">#proto</a>,
            
        
        <time class="post-date" datetime="2015-11-13T00:00:00Z">
            13 Nov 2015
        </time>
    </footer>
</article>

	
	   
<article class="post posts">
    <header class="post-header">
        <h2 class="post-title"><a href="/2015/11/11/erlang-applicationec9790-lagereba19ceab1b0-ecb694eab080ed9598eab8b0/">erlang application에 lager(로거)  추가하기</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            

<p><a href="https://erlnote.wordpress.com/2015/11/06/erlang-rebar%EC%9D%98-project-template%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-application-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0/">rebar를 사용해 프로젝트를 생성</a>했다고 가정한다.</p>

<p>erlang의 로거 라이브러리 중에서 많이 사용되는 basho/lager를 추가해 보도록 하자.</p>

<h2 id="rebar-config-수정">rebar.config 수정</h2>

<pre><code>  
%% -\*- erlang -\*-

{sub_dirs, [
    
&quot;apps/chat&quot;,
    
&quot;deps&quot;,
    
&quot;rel&quot;
  
]}.

{erl_opts, [
    
{parse\_transform, lager\_transform}, %% for lager
    
debug_info,
    
fail\_on\_warning
  
]}.

%% {require\_otp\_vsn, &quot;R14&quot;}.

%% Example, uncomment to retrieve cowboy as a dep.
  
{deps, [
    
{'lager', &quot;.*&quot;, {git, &quot;https://github.com/basho/lager&quot;, &quot;&quot;}}
  
]}.

</code></pre>

<ul>
<li>sub_dirs에 deps 디렉토리를 추가하고,</li>
<li>erl_opts(erlang 컴파일러 옵션)에 {parse_transform, lager_transform}을 추가한다.</li>
<li>deps에 {&#8216;lager&#8217;, &#8230;}처럼 lager dependency를 추가한다.</li>
</ul>

<h2 id="rel-reltool-config-수정">rel/reltool.config 수정</h2>

<p>두 번째로 rel/reltool.config를 다음과 같이 수정한다.</p>

<pre><code>  
%% -\*- erlang -\*-

{sys, [
         
{lib_dirs, [&quot;../apps&quot;, &quot;../deps&quot;]},
         
{rel, &quot;myweb&quot;, &quot;0.1.0&quot;,
          
[
           
kernel,
           
stdlib,
           
sasl,
           
lager,
           
chat
          
]},
  
&amp;#8230;
  
</code></pre>

<ul>
<li>lib_dirs에 ../deps 디렉토리를 추가한다.</li>
<li>모듈에 lager를 추가한다.</li>
</ul>

<h2 id="xxx-app-erl-수정">XXX_app.erl 수정</h2>

<p>application behaviour를 구현한 모듈의 start/2 함수의 시작부분에 lager:start/0를 추가한다.</p>

<pre><code class="language-erlang">  
start(\_StartType, \_StartArgs) -&gt;
    
lager:start(),
    
&amp;#8230;
  
</code></pre>

<h2 id="로그-작성">로그 작성</h2>

<p>로그를 출력하고자 한다면 다음과 같이 lager의 info, error등의 함수를 사용해 출력한다.</p>

<pre><code class="language-erlang">  
lager:info(&quot;Hello, world!&quot;).
  
lager:error(&quot;Error raised!&quot;).
  
</code></pre>

<h2 id="참고">참고</h2>

<p>기타 자세한 내용은 다음 링크를 참고한다.</p>

<ul>
<li><a href="https://github.com/basho/lager">basho/lager</a></li>
</ul>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
        
        
            
        
        on
            
                <a href="https://jeidee.github.iotags/lager/">#lager</a>,
            
                <a href="https://jeidee.github.iotags/logger/">#logger</a>,
            
        
        <time class="post-date" datetime="2015-11-11T00:00:00Z">
            11 Nov 2015
        </time>
    </footer>
</article>

	

	<nav class="pagination" role="navigation">
	
	<span class="page-number">Page 1 of 5</span>
	
	    <a class="older-posts" href="/categories/erlang/page/2/">Older Posts &rarr;</a>
	
</nav>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Erlang &amp; Go</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="https://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/syui/hugo-theme-air">hugo-theme-air</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://jeidee.github.iojs/jquery.js"></script>
    <script type="text/javascript" src="https://jeidee.github.iojs/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://jeidee.github.iojs/index.js"></script>

</body>
</html>

