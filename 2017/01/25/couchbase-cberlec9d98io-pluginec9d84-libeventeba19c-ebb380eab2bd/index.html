<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.31.1" />



<link rel="canonical" href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>couchbase cberl의IO Plugin을 libevent로 변경 - Erlang &amp; Go</title>
    
<meta name="description" content="cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.">

<meta property="og:title" content="couchbase cberl의IO Plugin을 libevent로 변경 - Erlang &amp; Go">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">
<meta property="og:image" content="https://jeidee.github.io/images/default.png">
<meta property="og:site_name" content="Erlang &amp; Go">
<meta property="og:description" content="cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Erlang &amp; Go">
<meta name="twitter:url" content="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">
<meta name="twitter:title" content="couchbase cberl의IO Plugin을 libevent로 변경 - Erlang &amp; Go">
<meta name="twitter:description" content="cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.">
<meta name="twitter:image" content="https://jeidee.github.io/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https://jeidee.github.io/"
    },
    "headline": "couchbase cberl의IO Plugin을 libevent로 변경 - Erlang &amp; Go",
    "image": {
      "@type": "ImageObject",
      "url": "https://jeidee.github.io/images/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2017-01-25T00:00:00JST",
    "dateModified": "2017-01-25T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Erlang &amp; Go"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Erlang &amp; Go",
      "logo": {
        "@type": "ImageObject",
        "url": "https://jeidee.github.io/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.
그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.
실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.
(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다."
  }
</script>


    <link href="https://jeidee.github.io/css/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://jeidee.github.io/">Erlang &amp; Go</a>
          </div>

          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="https://jeidee.github.io/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://jeidee.github.io/posts/" itemprop="url"><span itemprop="title">posts</span></a></li>
        
        <li class="active">couchbase cberl의IO Plugin을 libevent로 변경</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2017-01-25T00:00:00JST">Jan 25, 2017</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="https://jeidee.github.io/posts/">posts</a></li>
      
    </ul>

    <h1 class="title">couchbase cberl의IO Plugin을 libevent로 변경</h1>
  </header>

  

  <div class="article-body"><p>cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.</p>

<p>그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.</p>

<p>실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.</p>

<p>(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.)</p>

<pre><code>  
%% LCB\_CNTL\_CONLOGGER_LEVEL
  
cberl:cntl(?POOL_ID, 1, 16#29, 5). 

COUCHBASE: too many FDs. Cannot have socket FD_SETSIZE. Use other I/O plugin
  
</code></pre>

<p><a href="https://developer.couchbase.com/documentation/server/current/sdk/c/start-using-sdk.html">https://developer.couchbase.com/documentation/server/current/sdk/c/start-using-sdk.html</a></p>

<p>해당 문서에는 다음과 같이 적시되어 있다.</p>

<blockquote>
<p>You should install the libcouchbase2-libevent plugin in case your application will use more than 1024 file descriptors. The default select() based event loop only supports 1024 file descriptors.</p>
</blockquote>

<p>libevent로 변경하기 위해서는 cberl의 cb.c 소스를 다음과 같이 수정해야 한다.</p>

<p><a href="https://gist.github.com/jeidee/62ed9a02b844c4e6efc587ff5ca5d973">https://gist.github.com/jeidee/62ed9a02b844c4e6efc587ff5ca5d973</a></p>

<p>그리고 실행될 erlang application이 있는 서버에 libcouchbase2-libevent 플러그인이 설치되어 있어야 한다.</p>

<p>centos 6에서는 다음과 같이 설치할 수 있다.</p>

<pre><code>  
\# wget http://packages.couchbase.com/releases/couchbase-release/couchbase-release-1.0-0-x86_64.rpm
  
\# rpm -i couchbase-release-1.0-0-x86_64.rpm
  
\# yum install libcouchbase2-libevent
  
</code></pre>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="https://jeidee.github.io/categories/couchbase/">couchbase</a></li>
          
          <li><a href="https://jeidee.github.io/categories/erlang/">erlang</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">TAGS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="https://jeidee.github.io/tags/45/">45</a></li>
          
          <li><a href="https://jeidee.github.io/tags/cberl/">cberl</a></li>
          
        </ul>
      </div>
    </section>
    
    
  </footer>

</article>


    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-erlnote-wordpress-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/2017/08/31/upstart-ec84a4eca095/" class="list-group-item">upstart 설정</a>
      
      <a href="https://jeidee.github.io/2017/06/08/centosec9790ec849c-mongodb-ec84a4ecb998ec9980-service-eb93b1eba19d/" class="list-group-item">CentOS에서 MongoDB 설치와 Service 등록</a>
      
      <a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/" class="list-group-item">couchbase cberl에 lcb_cntl 함수 추가</a>
      
      <a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/" class="list-group-item">couchbase cberl의IO Plugin을 libevent로 변경</a>
      
      <a href="https://jeidee.github.io/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/" class="list-group-item">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a>
      
      <a href="https://jeidee.github.io/2017/01/03/aws-dynamodb-for-go/" class="list-group-item">AWS DynamoDB for Go</a>
      
      <a href="https://jeidee.github.io/2016/12/21/aws-credentialseab080-upstart-eb93b1ec9790ec849c-eca09ceb8c80eba19c-eb8f99ec9e91ed9598eca780-ec958aec9d84-eab2bdec9ab0/" class="list-group-item">AWS Credentials가 upstart 등에서 제대로 동작하지 않을 경우</a>
      
      <a href="https://jeidee.github.io/2016/09/02/c-rest-sdk/" class="list-group-item">c&#43;&#43; REST SDK</a>
      
      <a href="https://jeidee.github.io/2016/09/01/c-openssl-aes-ecb/" class="list-group-item">c&#43;&#43; openssl AES ECB</a>
      
      <a href="https://jeidee.github.io/2016/09/01/cc-hex-string-to-byte-array/" class="list-group-item">c/c&#43;&#43; hex string to byte array</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/categories/erlang" class="list-group-item">erlang</a>
      
      <a href="https://jeidee.github.io/categories/ejabberd" class="list-group-item">ejabberd</a>
      
      <a href="https://jeidee.github.io/categories/elixir" class="list-group-item">elixir</a>
      
      <a href="https://jeidee.github.io/categories/ios" class="list-group-item">ios</a>
      
      <a href="https://jeidee.github.io/categories/c&#43;&#43;" class="list-group-item">c&#43;&#43;</a>
      
      <a href="https://jeidee.github.io/categories/node.js" class="list-group-item">node.js</a>
      
      <a href="https://jeidee.github.io/categories/utility" class="list-group-item">utility</a>
      
      <a href="https://jeidee.github.io/categories/android" class="list-group-item">android</a>
      
      <a href="https://jeidee.github.io/categories/go" class="list-group-item">go</a>
      
      <a href="https://jeidee.github.io/categories/couchbase" class="list-group-item">couchbase</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/tags/tutorial" class="list-group-item">tutorial</a>
      
      <a href="https://jeidee.github.io/tags/ndk" class="list-group-item">ndk</a>
      
      <a href="https://jeidee.github.io/tags/express" class="list-group-item">express</a>
      
      <a href="https://jeidee.github.io/tags/mnesia" class="list-group-item">mnesia</a>
      
      <a href="https://jeidee.github.io/tags/mysql" class="list-group-item">mysql</a>
      
      <a href="https://jeidee.github.io/tags/cberl" class="list-group-item">cberl</a>
      
      <a href="https://jeidee.github.io/tags/clustering" class="list-group-item">clustering</a>
      
      <a href="https://jeidee.github.io/tags/custom-module" class="list-group-item">custom-module</a>
      
      <a href="https://jeidee.github.io/tags/debug" class="list-group-item">debug</a>
      
      <a href="https://jeidee.github.io/tags/http" class="list-group-item">http</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; Erlang &amp; Go</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

