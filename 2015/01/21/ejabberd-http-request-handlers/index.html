<!DOCTYPE html>
<html lang="ko-kr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Erlang &amp; Go  | ejabberd http request handlers</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.51" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="ejabberd http request handlers" />
<meta property="og:description" content="ejabberd 모듈 개발 문서 중에 http request handlers 개발 관련해서 간단히 정리해 봅니다.
튜토리얼 &#8220;/hello&#8221;로 시작하는 URL에 대한 모든 요청을 처리하기 위해 &#8220;mod_http_hello&#8221;를 작성한다고 가정해 봅시다, 다음과 같이:
 http://localhost:5280/hello/world http://localhost:5280/hello/hedgehog  process/2 함수의 절을 갖는 request 핸들러를 포함하는 &#8220;mod_http_hello.erl&#8221;파일을 작성하는 것으로 시작합니다.
&#8220;/hello/world&#8221; 요청을 처리하는 예는 다음과 같습니다:
process(\_LocalPath = [&quot;world&quot;], \_Request) -&gt; {xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}], [{xmlelement, &quot;head&quot;, [], [{xmlelement, &quot;title&quot;, [], []}]}, {xmlelement, &quot;body&quot;, [], [{xmlelement, &quot;p&quot;, [], [{xmlcdata, &quot;Hello, world!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jeidee.github.io/2015/01/21/ejabberd-http-request-handlers/" /><meta property="article:published_time" content="2015-01-21T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2015-01-21T00:00:00&#43;00:00"/>

<meta itemprop="name" content="ejabberd http request handlers">
<meta itemprop="description" content="ejabberd 모듈 개발 문서 중에 http request handlers 개발 관련해서 간단히 정리해 봅니다.
튜토리얼 &#8220;/hello&#8221;로 시작하는 URL에 대한 모든 요청을 처리하기 위해 &#8220;mod_http_hello&#8221;를 작성한다고 가정해 봅시다, 다음과 같이:
 http://localhost:5280/hello/world http://localhost:5280/hello/hedgehog  process/2 함수의 절을 갖는 request 핸들러를 포함하는 &#8220;mod_http_hello.erl&#8221;파일을 작성하는 것으로 시작합니다.
&#8220;/hello/world&#8221; 요청을 처리하는 예는 다음과 같습니다:
process(\_LocalPath = [&quot;world&quot;], \_Request) -&gt; {xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}], [{xmlelement, &quot;head&quot;, [], [{xmlelement, &quot;title&quot;, [], []}]}, {xmlelement, &quot;body&quot;, [], [{xmlelement, &quot;p&quot;, [], [{xmlcdata, &quot;Hello, world!">


<meta itemprop="datePublished" content="2015-01-21T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2015-01-21T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="466">



<meta itemprop="keywords" content="custom module,http," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ejabberd http request handlers"/>
<meta name="twitter:description" content="ejabberd 모듈 개발 문서 중에 http request handlers 개발 관련해서 간단히 정리해 봅니다.
튜토리얼 &#8220;/hello&#8221;로 시작하는 URL에 대한 모든 요청을 처리하기 위해 &#8220;mod_http_hello&#8221;를 작성한다고 가정해 봅시다, 다음과 같이:
 http://localhost:5280/hello/world http://localhost:5280/hello/hedgehog  process/2 함수의 절을 갖는 request 핸들러를 포함하는 &#8220;mod_http_hello.erl&#8221;파일을 작성하는 것으로 시작합니다.
&#8220;/hello/world&#8221; 요청을 처리하는 예는 다음과 같습니다:
process(\_LocalPath = [&quot;world&quot;], \_Request) -&gt; {xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}], [{xmlelement, &quot;head&quot;, [], [{xmlelement, &quot;title&quot;, [], []}]}, {xmlelement, &quot;body&quot;, [], [{xmlelement, &quot;p&quot;, [], [{xmlcdata, &quot;Hello, world!"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://jeidee.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Erlang &amp; Go
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">ejabberd http request handlers</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2015-01-21T00:00:00Z">January 21, 2015</time>      
      
      
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p><a href="https://erlnote.wordpress.com/2015/01/21/ejabberd-%EB%AA%A8%EB%93%88-%EA%B0%9C%EB%B0%9C/">ejabberd 모듈 개발 문서</a> 중에 http request handlers 개발 관련해서 간단히 정리해 봅니다.</p>

<h2 id="튜토리얼">튜토리얼</h2>

<p>&#8220;/hello&#8221;로 시작하는 URL에 대한 모든 요청을 처리하기 위해 &#8220;mod_http_hello&#8221;를 작성한다고 가정해 봅시다, 다음과 같이:</p>

<ul>
<li><a href="http://localhost:5280/hello/world">http://localhost:5280/hello/world</a></li>
<li><a href="http://localhost:5280/hello/hedgehog">http://localhost:5280/hello/hedgehog</a></li>
</ul>

<p>process/2 함수의 절을 갖는 request 핸들러를 포함하는 &#8220;mod_http_hello.erl&#8221;파일을 작성하는 것으로 시작합니다.</p>

<p>&#8220;/hello/world&#8221; 요청을 처리하는 예는 다음과 같습니다:</p>

<pre><code class="language-erlang">      
process(\_LocalPath = [&quot;world&quot;], \_Request) -&gt;
          
{xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}],
           
[{xmlelement, &quot;head&quot;, [],
             
[{xmlelement, &quot;title&quot;, [], []}]},
            
{xmlelement, &quot;body&quot;, [],
             
[{xmlelement, &quot;p&quot;, [], [{xmlcdata, &quot;Hello, world!&quot;}]}]}]};
  
</code></pre>

<blockquote>
<p>모든 핸들러와 공통이기때문에, &#8220;hello&#8221; 파트는 여기에서 다루지 않습니다.</p>
</blockquote>

<p>&#8220;mod_http_hello.erl&#8221; 파일의 전체 소스는 다음과 같습니다:</p>

<pre><code class="language-erlang">  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
%%% File : mod\_http\_hello.erl
  
%%% Author : Your Name
  
%%% Purpose : Sample module that extends embedded ejabberd HTTP server
  
%%% Created :
  
%%% Id :
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-

-module(mod\_http\_hello).
  
-author('your@email.org').
  
-vsn('').
  
-define(ejabberd_debug, true).

-behaviour(gen_mod).

-export([
      
start/2,
      
stop/1,
      
process/2
      
]).

-include(&quot;ejabberd.hrl&quot;).
  
-include(&quot;jlib.hrl&quot;).
  
-include(&quot;ejabberd_http.hrl&quot;).

%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
%%% REQUEST HANDLERS
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-

process([&quot;world&quot;], _Request) -&gt;
      
{xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}],
       
[{xmlelement, &quot;head&quot;, [],
         
[{xmlelement, &quot;title&quot;, [], []}]},
        
{xmlelement, &quot;body&quot;, [],
         
[{xmlelement, &quot;p&quot;, [], [{xmlcdata, &quot;Hello, world!&quot;}]}]}]};

process([&quot;produce\_error&quot;], \_Request) -&gt;
      
{400, [], {xmlelement, &quot;h1&quot;, [],
                 
[{xmlcdata, &quot;400 Bad Request&quot;}]}};

process(LocalPath, _Request) -&gt;
      
{xmlelement, &quot;html&quot;, [{&quot;xmlns&quot;, &quot;http://www.w3.org/1999/xhtml&quot;}],
       
[{xmlelement, &quot;head&quot;, [],
         
[{xmlelement, &quot;title&quot;, [], []}]},
        
{xmlelement, &quot;body&quot;, [],
         
[{xmlelement, &quot;p&quot;, [], [{xmlcdata, io_lib:format(&quot;Called with path: ~p&quot;, [LocalPath])}]}]}]}.

%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-
  
%%% BEHAVIOUR CALLBACKS
  
%%%&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;-

start(\_Host, \_Opts) -&gt;
      
ok.

stop(_Host) -&gt;
      
ok.
  
</code></pre>

<p>ejabberd가 시작할 때 mod_http_hello를 로드하기 위해 ejabberd.yml을 다음과 같이 수정합니다.</p>

<blockquote>
<p>원문은 이전 버전의 ejabberd.cfg와 관련한 내용을 다루지만 번역자가 임의로 ejabberd.yml 관련 내용으로 변경했음을 알립니다.</p>
</blockquote>

<pre><code>      
modules:
        
mod\_http\_hello: {}
  
</code></pre>

<p>&rdquo;/hello/&rdquo; 요청을 디스패치하기 위해 ejabberd.yml파일의 ejabberd_http 모듈의 request_handlers에 다음과 같이 mod_http_hello를 등록합니다.</p>

<pre><code>      
port: 5280
      
module: ejabberd_http
        
request_handlers:
          
&quot;/hello&quot;: mod\_http\_hello
      
web_admin: true
      
http_poll: true
  
</code></pre>

<h2 id="api">API</h2>

<p>gen_mod가 요구하는 콜백과는 별개로, 커스텀 모듈은 (하나 이상의 절을 갖는) process/2 함수를 구현해야 합니다:</p>

<ul>
<li>your_http_module:process(LocalPath, Request)</li>
</ul>

<p>process/2 함수는 HTTP 요청을 처리하며 클라이언트에 보낼 데이터를 반환합니다. 선택적으로 상태 코드와 추가 헤더를 포함하기도 합니다.</p>

<p>process/2 함수는 두개의 매개변수를 갖습니다: LocalPath와 Request</p>

<p>LocalPath는 &ldquo;local to the module&rdquo;이라 불리는 요청 URL의 일부분을 포함하는 리스트입니다.</p>

<p>예를 들어 mod_foo가 다음과 같이 설정되었다고 가정하면:</p>

<pre><code>      
port: 5280
      
module: ejabberd_http
        
request_handlers:
          
&quot;/a/b&quot;: mod_foo
      
web_admin: true
      
http_poll: true
  
</code></pre>

<p>유저의 요청 URL이 다음과 같을 때:</p>

<p><a href="http://server:5280/a/b/c/d">http://server:5280/a/b/c/d</a></p>

<p>&ldquo;local to the moudle&rdquo;은 다음과 같습니다:</p>

<pre><code>      
[&quot;c&quot;, &quot;d&quot;]
  
</code></pre>

<p>일반적으로 서버 관리자는 그들이 선택한 path 접두사만 사용 가능하도록 모듈을 만들 수 있기 때문에, 여러분은 full path(Request#request.path) 대신에 local path 기반의 핸들러를 선택하고 싶을 것입니다.</p>

<p>Request 매개변수는 ejabberd_http.hrl에 정의된 HTTP request에 대한 정보를 포함하는 레코드입니다. 다음 필드로 구성됩니다:</p>

<pre><code>  
{
    
&quot;request&quot;,
    
method, %% HTTP method (&quot;GET&quot; or &quot;POST&quot;)
    
path, %% Full path to requested resource
               
%% e.g. for &quot;http://server:5280/a/b/c/d&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]
    
q, %% Query part of the URL
               
%% e.g. for &quot;http://server:5280/a/b/c/d?foo=bar&quot;: [{&quot;foo&quot;, &quot;bar&quot;}]
    
us, %% Authenticated user and server. Used in ejabberd\_web\_admin for now.
               
%% e.g. for &quot;foo@jabber.server.org&quot;: {&quot;foo&quot;, &quot;jabber.server.org&quot;}
    
auth, %% Information provided for HTTP-auth (if any)
               
%% e.g. for a user &quot;john&quot; who entered the password &quot;secret&quot;: {&quot;john&quot;, &quot;secret&quot;}
    
lang = &quot;&quot;, %% Language code
    
data = &quot;&quot;, %% POST data
  
}
  
</code></pre>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/custom-module" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">custom module</a>
   </li>
  
   <li class="list">
     <a href="/tags/http" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">http</a>
   </li>
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-erlnote-wordpress-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2015/01/21/ejabberd-ebaaa8eb9388-eab09cebb09c/">ejabberd 모듈 개발</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2015/01/21/ejabberd-node-jsec9bb9ec9790ec849c-ejabberd-http-api-ed98b8ecb69ced9598eab8b0/">ejabberd node.js웹에서 ejabberd http api 호출하기</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://jeidee.github.io/" >
    &copy; 2018 Erlang &amp; Go
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
