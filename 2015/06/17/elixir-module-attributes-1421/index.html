<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Elixir Module attributes (#14/21)</title>
	
	
	<link rel="stylesheet" href="https://jeidee.github.io/css/style.css">
	
	<meta name="generator" content="Hugo 0.31.1" />
</head>
<body>
	<header>
		<a href="https://jeidee.github.io/">Erlang &amp; Go</a>
		<nav>
			<ul>
				
			</ul>
		</nav>
	</header>
	<main>
		<article>
			<h1>Elixir Module attributes (#14/21)</h1>
			<time>17.06.2015 00:00</time>
			<div>
				

<blockquote>
<p>본 문서는 elixir-lang.org의 <a href="http://elixir-lang.org/getting-started/introduction.html">Getting Started</a>문서의 한글 번역본입니다.</p>

<p>자세한 내용은 원문을 참조해 주세요.</p>
</blockquote>

<p>elixir에서 모듈의 속성은 3개의 목적으로 제공된다.</p>

<ul>
<li>모듈에 주석을 제공한다. 사용자와 VM에 정보를 제공한다.</li>
<li>상수로 동작한다.</li>
<li>컴파일하는 동안 임시 모듈 저장공간으로 사용된다.</li>
</ul>

<p>하나씩 살펴보자.</p>

<h2 id="as-annotations">As annotations</h2>

<p>elixir는 모듈 속성 컨셉을 Erlang에서 가져왔다. 예를 보자.</p>

<pre><code>  
defmodule MyServer do
    
@vsn 2
  
end
  
</code></pre>

<p>위의 예는, 모듈의 버전 속성을 명시적으로 설정한다. @vsn은 Erlang VM이 모듈이 수정되었는지 여부를 검사해서 코드를 리로딩할 지 결정하는 매커니즘으로 사용한다. @vsn이 명시되지 않을 경우 모듈 함수의 버전으로 MD5 체크섬이 설정된다.</p>

<p>elixir는 소수의 예약된 속성을 갖는다. 그들 중 흔히 사용되는 것들 몇 개만 살펴보도록 하자.</p>

<ul>
<li>@moduledoc &#8211; 현재 모듈의 문서를 제공한다.</li>
<li>@doc &#8211; 함수나 매크로의 문서를 제공한다.</li>
<li>@behaviour &#8211; OTP 또는 유저가 정의한 behaviour를 명시한다.</li>
<li>@before_compile &#8211; 모듈이 컴파일될 때 불려지는 동작을 명시한다. 이것은 컴파일 타임에 특정 함수를 모듈에 주입(inject)할 수 있게 해 준다.</li>
</ul>

<p>@moduledoc과 @doc은 흔히 사용하는 속성인데, 가능하면 많이 사용하도록 해야 한다. elixir는 문서를 일등급(first-class)으로 취급하고 문서에 접근할 수 있는 많은 함수를 제공한다.</p>

<p>이전 챕터에서 정의한 Math 모듈로 되돌아가 보자. math.ex 파일에 다음과 같이 문서를 추가해 보자.</p>

<pre><code>  
defmodule Math do
    
@moduledoc &quot;&quot;&quot;
    
Provides math-related functions.

\## Examples

iex&gt; Math.sum(1, 2)
        
3

&quot;&quot;&quot;

@doc &quot;&quot;&quot;
    
Calculates the sum of two numbers.
    
&quot;&quot;&quot;
    
def sum(a, b), do: a + b
  
end
  
</code></pre>

<p>elixir는 가독성 있는 문서를 작성하는데 <a href="http://zetawiki.com/wiki/HEREDOC">heredoc</a>(문자열을 코드 중간에 그대로 포함)과 함께 마크다운 문법을 사용하도록 권고한다. heredoc은 여러 줄의 문자열로 이뤄져 있고 시작과 끝은 &#8220;&#8221;&#8221;(triple quotes)으로 묶으며 입력한 그대로의 형태를 유지한다. 우리는 컴파일된 모듈의 문서를 iex를 통해 볼 수 있다.</p>

<pre><code>  
$ elixirc math.ex
  
$ iex

iex&gt; h Math # Access the docs for the module Math
  
&amp;#8230;
  
iex&gt; h Math.sum # Access the docs for the sum function
  
&amp;#8230;
  
</code></pre>

<p>우리는 <a href="https://github.com/elixir-lang/ex_doc">ExDoc</a>이라고 불리는 도구를 사용해 HTML 페이지 형태의 문서를 만들 수도 있다.</p>

<p>지원되는 속성의 전체 리스트는 <a href="http://elixir-lang.org/docs/stable/elixir/#!Module.html">Module</a> 문서에서 볼 수 있다. elixir는 또한 <a href="http://elixir-lang.org/docs/stable/elixir/#!Kernel.Typespec.html">typespecs</a>를 정의해서 속성을 만들수도 있다.</p>

<ul>
<li>@spec &#8211; 함수를 위한 명세를 제공</li>
<li>@callback &#8211; behaviour 콜백을 위한 명세를 제공</li>
<li>@type &#8211; @spec에서 사용되는 타입을 정의</li>
<li>@typep &#8211; @spec에서 사용되는 private 타입을 정의</li>
<li>@opaque &#8211; @spec에서 사용하는 opaque 타입(변수의 조작을 함수를 통해서만 가능하도록 하는 타입)을 정의</li>
</ul>

<p>이 섹션에서는 내장된(built-in) 속성만 언급했다. 하지만, 속성은 개발자에 의해 사용될 뿐만 아니라 커스텀 behaviour를 지원하는 라이브러리에 의해서 확장될 수도 있다.</p>

<h2 id="as-constants">As constants</h2>

<p>elixir 개발자는 모듈 속성을 상수로 사용하기도 한다.</p>

<pre><code>  
defmodule MyServer do
    
@initial_state %{host: &quot;147.0.0.1&quot;, port: 3456}
    
IO.inspect @initial_state
  
end
  
</code></pre>

<blockquote>
<p>Erlang과 다르게, 유저가 정의한 속성은 기본적으로 모듈에 저장되지 않는다. 값은 오직 컴파일시에만 존재한다. 개발자가 Erlang과 유사하게 속성을 설정하고 싶다면 Module.register_attribute/3 함수를 사용해야 한다.</p>
</blockquote>

<p>정의되지 않은 속성에 접근하게 되면 경고를 출력할 것이다.</p>

<pre><code>  
defmodule MyServer do
    
@unknown
  
end
  
warning: undefined module attribute @unknown, please remove access to @unknown or explicitly set it to nil before access
  
</code></pre>

<p>속성은 함수 안에서 다음과 같이 사용될 수 있다.</p>

<pre><code>  
defmodule MyServer do
    
@my_data 14
    
def first\_data, do: @my\_data
    
@my_data 13
    
def second\_data, do: @my\_data
  
end

MyServer.first_data #=&gt; 14
  
MyServer.second_data #=&gt; 13
  
</code></pre>

<p>함수 안에서 속성을 읽는 순간 현재 값의 스냅샷을 가져온다는 것을 명심하자. 다른 말로, 값은 컴파일시에 읽혀질뿐, 런타임에 읽혀지는 것이 아니다. 우리가 살펴본대로, 속성은 모듈이 컴파일되는 동안 저장공간으로 유용하게 사용될 수 있다.</p>

<h2 id="as-temporary-storage">As temporary storage</h2>

<p>elixir로 구성한 프로젝트 중에 <a href="https://github.com/elixir-lang/plug">Plug</a> 프로젝트가 있는데, elixir에서 웹 라이브러리와 프레임워크를 만드는데 기초가 되는 프로젝트이다.</p>

<p>Plug 라이브러리는 개발자가 웹서버에서 실행될 수 있는 그들 자신의 plug를 정의할 수 있게 해 준다.</p>

<pre><code>  
defmodule MyPlug do
    
use Plug.Builder

plug :set_header
    
plug :send_ok

def set\_header(conn, \_opts) do
      
put\_resp\_header(conn, &quot;x-header&quot;, &quot;set&quot;)
    
end

def send\_ok(conn, \_opts) do
      
send(conn, 200, &quot;ok&quot;)
    
end
  
end

IO.puts &quot;Running MyPlug with Cowboy on http://localhost:4000&quot;
  
Plug.Adapters.Cowboy.http MyPlug, []
  
</code></pre>

<p>위의 예제에서, 우리는 웹 요청이 있을 때 호출되는 함수 연결을 위해 plug/1 매크로를 사용했다. 내부적으로, 매번 plug/1을 호출할 때마다, Plug 라이브러리는 @plugs 속성에 있는 주어진 매개변수를 저장한다. 모듈이 컴파일되기 직전에, Plug는 http 요청을 처리하는 call/2 메서드를 정의하는 콜백을 실행한다. 이 메서드는 순서대로 @plugs 안에서 모든 plug를 실행할 것이다.</p>

<p>아래 코드를 이해하기 위해, 우리는 매크로가 필요한데, 이 매크로는 메타 프로그래밍 가이드에서 다시 한 번 살펴볼 것이다. 어쨌든, 여기에서 집중할 것은, 어떻게 모듈 속성을 저장공간으로 사용하는 것이 개발자로 하여금 DSL(?)을 생성하도록 허용하는가이다.</p>

<p>모듈 속성을 주석과 저장소로 사용하는 ExUnit 프레임워크의 예제를 보도록 하자.</p>

<pre><code>  
defmodule MyTest do
    
use ExUnit.Case

@tag :external
    
test &quot;contacts external service&quot; do
      
\# &amp;#8230;
    
end
  
end
  
</code></pre>

<p>ExUnit의 태그는 주석 테스트에 사용된다. 태그를 사용해 테스트를 필터링할 수 있다. 예를 들어, 느리거나 다른 서비스에 의존성이 있는 외부 테스트를 실행하지 않을 수 있다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://elixir-lang.org/getting-started/module-attributes.html">Elixir Module attributes</a></li>
</ul>

			</div>
			<div>
				<ul id="tags">
					
					<li><a href="/tags/tutorial">tutorial</a> </li>
					
				</ul>
			</div>
			<div>
				
			</div>
		</article>
	</main>
	<aside>
		<div>
			<div>
				<h3>LATEST POSTS</h3>
			</div>
			<div>
				<ul>
					
					<li><a href="https://jeidee.github.io/2017/08/31/upstart-ec84a4eca095/">upstart 설정</a></li>
					
					<li><a href="https://jeidee.github.io/2017/06/08/centosec9790ec849c-mongodb-ec84a4ecb998ec9980-service-eb93b1eba19d/">CentOS에서 MongoDB 설치와 Service 등록</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/">couchbase cberl에 lcb_cntl 함수 추가</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">couchbase cberl의IO Plugin을 libevent로 변경</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a></li>
					
				</ul>
			</div>
		</div>
	</aside>

	<footer>
		<p>&copy; 2017 <a href="https://jeidee.github.io/">Erlang &amp; Go</a></p>
	</footer>
</body>
</html>