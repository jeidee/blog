<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Elixir Structs (#15/21)</title>
	
	
	<link rel="stylesheet" href="https://jeidee.github.io/css/style.css">
	
	<meta name="generator" content="Hugo 0.31.1" />
</head>
<body>
	<header>
		<a href="https://jeidee.github.io/">Erlang &amp; Go</a>
		<nav>
			<ul>
				
			</ul>
		</nav>
	</header>
	<main>
		<article>
			<h1>Elixir Structs (#15/21)</h1>
			<time>17.06.2015 00:00</time>
			<div>
				

<blockquote>
<p>본 문서는 elixir-lang.org의 <a href="http://elixir-lang.org/getting-started/introduction.html">Getting Started</a>문서의 한글 번역본입니다.</p>

<p>자세한 내용은 원문을 참조해 주세요.</p>
</blockquote>

<p>이전 챕터에서 우리는 맵에 대해 배웠다.</p>

<pre><code>  
iex&gt; map = %{a: 1, b: 2}
  
%{a: 1, b: 2}
  
iex&gt; map[:a]
  
1
  
iex&gt; %{map | a: 3}
  
%{a: 3, b: 2}
  
</code></pre>

<p>구조체는 컴파일 타임 검사와 기본값을 제공하는 맵의 확장이다.</p>

<h2 id="defining-structs">Defining structs</h2>

<p>구조체를 정의하기 위해, defstruct를 사용한다.</p>

<pre><code>  
iex&gt; defmodule User do
  
&amp;#8230;&gt; defstruct name: &quot;John&quot;, age: 27
  
&amp;#8230;&gt; end
  
</code></pre>

<p>defstruct에 사용된 키워드 리스트는, 어떤 필드가 어떤 기본값을 갖는지 정의한다.</p>

<p>구조체는 구조체가 정의된 모듈의 이름을 통해서 가져온다. 위의 예에는 User 모듈에 구조체를 정의했다.</p>

<p>우리가 만든 User 구조체는 맵과 유사한 구문으로 사용할 수 있다.</p>

<pre><code>  
iex&gt; %User{}
  
%User{age: 27, name: &quot;John&quot;}
  
iex&gt; %User{name: &quot;Meg&quot;}
  
%User{age: 27, name: &quot;Meg&quot;}
  
</code></pre>

<p>구조체는 컴파일타임에 defstruct를 통해 정의된 필드만 사용할 수 있음을 보장한다.</p>

<pre><code>  
iex&gt; %User{oops: :field}
  
** (CompileError) iex:3: unknown key :oops for struct User
  
</code></pre>

<h2 id="accessing-and-updating-structs">Accessing and updating structs</h2>

<p>우리가 맵을 배울때, 맵의 필드에 어떻게 접근하고 값을 수정할 수 있는지 보여주었다. 같은 테크닉(같은 구문)으로 구조체를 사용할 수 있다.</p>

<pre><code>  
iex&gt; john = %User{}
  
%User{age: 27, name: &quot;John&quot;}
  
iex&gt; john.name
  
&quot;John&quot;
  
iex&gt; meg = %{john | name: &quot;Meg&quot;}
  
%User{age: 27, name: &quot;Meg&quot;}
  
iex&gt; %{meg | oops: :field}
  
** (ArgumentError) argument error
  
</code></pre>

<p>수정 구문(|)을 사용할 때, VM은 메모리에 저장된 공유 구조체 하부가 맵이기 때문에, 어떤 새로운 키도 추가되지 않을 것임을 알고 있다. 위의 예에서, john과 meg은 메모리에서 동일한 키를 공유하고 있다.</p>

<p>구조체는 패턴 매칭에도 사용될 수 있다.</p>

<pre><code>  
iex&gt; %User{name: name} = john
  
%User{age: 27, name: &quot;John&quot;}
  
iex&gt; name
  
&quot;John&quot;
  
iex&gt; %User{} = %{}
  
** (MatchError) no match of right hand side value: %{}
  
</code></pre>

<h2 id="structs-are-just-bare-maps-underneath-구조체는-사실-순수한-맵이다">Structs are just bare maps underneath(구조체는 사실 순수한 맵이다.)</h2>

<p>위의 예에서, 패턴매칭이 동작하는 이유는 하부 구조가 단순히 맵이기 때문이다. 맵 처럼, 구조체도 <strong>struct</strong>라는 &#8220;특별한&#8221; 필드를 저장하는데, 구조체의 이름을 보유하고 있다.</p>

<pre><code>  
iex&gt; is_map(john)
  
true
  
iex&gt; john.\_\_struct\_\_
  
User
  
</code></pre>

<p>우리는 맵을 위해 구현된 어떤 프로토콜도 구조체에서는 사용할 수 없기 때문에, 순수한 맵처럼 취급해야 함을 명심하자. 예를 들어, 구조체 내부를 접근해서 열거할 수 없다.</p>

<pre><code>  
iex&gt; john = %User{}
  
%User{age: 27, name: &quot;John&quot;}
  
iex&gt; john[:name]
  
** (Protocol.UndefinedError) protocol Access not implemented for %User{age: 27, name: &quot;John&quot;}
  
iex&gt; Enum.each john, fn({field, value}) -&gt; IO.puts(value) end
  
** (Protocol.UndefinedError) protocol Enumerable not implemented for %User{age: 27, name: &quot;John&quot;}
  
</code></pre>

<p>구조체는 사전(dictionary) 역시 아니므로 Dict 모듈의 함수에서 사용할 수 없다.</p>

<pre><code>  
iex&gt; Dict.get(%User{}, :name)
  
** (UndefinedFunctionError) undefined function: User.fetch/2
  
</code></pre>

<p>하지만, 구조체는 맵이기 때문에, Map 모듈의 함수에서는 사용할 수 있다.</p>

<pre><code>  
iex&gt; kurt = Map.put(%User{}, :name, &quot;Kurt&quot;)
  
%User{age: 27, name: &quot;Kurt&quot;}
  
iex&gt; Map.merge(kurt, %User{name: &quot;Takashi&quot;})
  
%User{age: 27, name: &quot;Takashi&quot;}
  
iex&gt; Map.keys(john)
  
[:\_\_struct\_\_, :age, :name]
  
</code></pre>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://elixir-lang.org/getting-started/structs.html">Elixir Structs</a></li>
</ul>

			</div>
			<div>
				<ul id="tags">
					
					<li><a href="/tags/tutorial">tutorial</a> </li>
					
				</ul>
			</div>
			<div>
				
			</div>
		</article>
	</main>
	<aside>
		<div>
			<div>
				<h3>LATEST POSTS</h3>
			</div>
			<div>
				<ul>
					
					<li><a href="https://jeidee.github.io/2017/08/31/upstart-ec84a4eca095/">upstart 설정</a></li>
					
					<li><a href="https://jeidee.github.io/2017/06/08/centosec9790ec849c-mongodb-ec84a4ecb998ec9980-service-eb93b1eba19d/">CentOS에서 MongoDB 설치와 Service 등록</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/">couchbase cberl에 lcb_cntl 함수 추가</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">couchbase cberl의IO Plugin을 libevent로 변경</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a></li>
					
				</ul>
			</div>
		</div>
	</aside>

	<footer>
		<p>&copy; 2017 <a href="https://jeidee.github.io/">Erlang &amp; Go</a></p>
	</footer>
</body>
</html>