<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.31.1" />



<link rel="canonical" href="https://jeidee.github.io/2015/03/04/ejabberd-external-component-ec97b0eb8f99/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>ejabberd external component 연동 - Erlang &amp; Go</title>
    
<meta name="description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.">

<meta property="og:title" content="ejabberd external component 연동 - Erlang &amp; Go">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jeidee.github.io/2015/03/04/ejabberd-external-component-ec97b0eb8f99/">
<meta property="og:image" content="https://jeidee.github.io/images/default.png">
<meta property="og:site_name" content="Erlang &amp; Go">
<meta property="og:description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Erlang &amp; Go">
<meta name="twitter:url" content="https://jeidee.github.io/2015/03/04/ejabberd-external-component-ec97b0eb8f99/">
<meta name="twitter:title" content="ejabberd external component 연동 - Erlang &amp; Go">
<meta name="twitter:description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.">
<meta name="twitter:image" content="https://jeidee.github.io/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https://jeidee.github.io/"
    },
    "headline": "ejabberd external component 연동 - Erlang &amp; Go",
    "image": {
      "@type": "ImageObject",
      "url": "https://jeidee.github.io/images/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2015-03-04T00:00:00JST",
    "dateModified": "2015-03-04T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Erlang &amp; Go"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Erlang &amp; Go",
      "logo": {
        "@type": "ImageObject",
        "url": "https://jeidee.github.io/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.
Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.
xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.
echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자."
  }
</script>


    <link href="https://jeidee.github.io/css/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-110408557-1', 'auto');
ga('send', 'pageview');
</script>

    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://jeidee.github.io/">Erlang &amp; Go</a>
          </div>

          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="https://jeidee.github.io/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://jeidee.github.io/posts/" itemprop="url"><span itemprop="title">posts</span></a></li>
        
        <li class="active">ejabberd external component 연동</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2015-03-04T00:00:00JST">Mar 4, 2015</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="https://jeidee.github.io/posts/">posts</a></li>
      
    </ul>

    <h1 class="title">ejabberd external component 연동</h1>
  </header>

  

  <div class="article-body">

<h2 id="xmpp-component-개요">xmpp component 개요</h2>

<p>xmpp에는 external component 관련 공식 프로토콜인 <a href="http://xmpp.org/extensions/xep-0114.html">Jabber Component Protocol</a>이 있다.</p>

<p>Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.</p>

<p>xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 <a href="https://www.ejabberd.im/tutorials-transports">Install Components and Transports to othe networks</a> 문서를 참고하도록 한다.</p>

<h2 id="echo-bot-component-만들어서-연동해-보기">echo-bot component 만들어서 연동해 보기</h2>

<p>node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.</p>

<p>우선 다음과 같이 node-xmpp-component와 node-xmpp-core를 설치한다.</p>

<pre><code>  
$ npm install node-xmpp-component
  
$ npm install node-xmpp-core
  
</code></pre>

<p>다음과 같이 에코 봇을 작성한다.</p>

<pre><code class="language-javascript">  
var Component = require('node-xmpp-component')
      
, argv = process.argv
      
, ltx = require('node-xmpp-core').ltx

if (argv.length &lt; 6) {
      
console.error('Usage: node echo_bot.js &lt;my-jid&gt; &lt;my-password&gt; ' +
      
'&lt;server&gt; &lt;port&gt;')
      
process.exit(1)
  
}

var component = new Component({
      
jid: argv[2],
      
password: argv[3],
      
host: argv[4],
      
port: Number(argv[5]),
      
reconnect: true
  
})

component.on('online', function() {
      
console.log('Component is online')

component.on('stanza', function(stanza) {
          
console.log('Received stanza: ', stanza)
          
if (stanza.is('message') &amp;&amp; stanza.attrs.type === 'chat') {
              
var i = parseInt(stanza.getChildText('body'))
              
var reply = new ltx.Element('message', { to: stanza.attrs.from, from: stanza.attrs.to, type: 'chat' })
              
reply.c('body').t(stanza)
              
component.send(reply)
          
}
      
})
  
})

component.on('offline', function () {
      
console.log('Component is offline')
  
})

component.on('connect', function () {
      
console.log('Component is connected')
  
})

component.on('reconnect', function () {
      
console.log('Component reconnects …')
  
})

component.on('disconnect', function (e) {
      
console.log('Component is disconnected', e)
  
})

component.on('error', function(e) {
      
console.error(e)
      
process.exit(1)
  
})

process.on('exit', function () {
      
component.end()
  
})
  
</code></pre>

<p>ejabberd.yml을 다음과 같이 수정한다.</p>

<pre><code>  
##
    
\## ejabberd_service: Interact with external components (transports, &amp;#8230;)
    
##
    
&amp;#8211;
       
port: 8888
       
module: ejabberd_service
       
access: all
       
shaper_rule: fast
       
ip: &quot;127.0.0.1&quot;
       
hosts:
         
&quot;foo.hello.world&quot;:
           
password: &quot;foo&quot;

</code></pre>

<p>ejabberd를 시작한 후 다음과 같이 컴포넌트를 시작한다.</p>

<pre><code>  
$ ejabberdctl start
  
$ node echo_bot.js foo.hello.world foo localhost 8888
  
</code></pre>

<p>정상적으로 연결이 될 경우 다음과 같은 메세지가 출력된다.</p>

<pre><code>  
Component is connected
  
Component is online
  
</code></pre>

<p>이 상태에서 XMPP 클라이언트로 접속한 후 foo.hello.world에게 메세지를 전송해 보자.</p>

<p>문제가 없을 경우 보낸 메세지가 다시 내게로 돌아오게 된다.</p>

<h2 id="활용">활용</h2>

<p>xmpp component의 활용은 다양하게 활용될 수 있다. 다른 메신저 서비스에 메세지 라우팅을 하거나, 날씨/사전/FAQ등의 봇 서비스에 활용될 수도 있다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="https://www.ejabberd.im/tutorials-transports">Install Components and Transports to Other Networks</a></li>
<li><a href="https://www.ejabberd.im/node/5134">Configuring Ejabberd to use an external component (with XEP-0114)</a></li>
<li><a href="http://xmpp.org/extensions/xep-0114.html">Jabber Component Protocol</a></li>
<li><a href="https://github.com/node-xmpp/node-xmpp-component">node-xmpp-component</a></li>
</ul>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="https://jeidee.github.io/categories/ejabberd/">ejabberd</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">TAGS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="https://jeidee.github.io/tags/bot/">bot</a></li>
          
          <li><a href="https://jeidee.github.io/tags/component/">component</a></li>
          
        </ul>
      </div>
    </section>
    
    
  </footer>

</article>


    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-erlnote-wordpress-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/2017/08/31/upstart-ec84a4eca095/" class="list-group-item">upstart 설정</a>
      
      <a href="https://jeidee.github.io/2017/06/08/centosec9790ec849c-mongodb-ec84a4ecb998ec9980-service-eb93b1eba19d/" class="list-group-item">CentOS에서 MongoDB 설치와 Service 등록</a>
      
      <a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/" class="list-group-item">couchbase cberl에 lcb_cntl 함수 추가</a>
      
      <a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/" class="list-group-item">couchbase cberl의IO Plugin을 libevent로 변경</a>
      
      <a href="https://jeidee.github.io/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/" class="list-group-item">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a>
      
      <a href="https://jeidee.github.io/2017/01/03/aws-dynamodb-for-go/" class="list-group-item">AWS DynamoDB for Go</a>
      
      <a href="https://jeidee.github.io/2016/12/21/aws-credentialseab080-upstart-eb93b1ec9790ec849c-eca09ceb8c80eba19c-eb8f99ec9e91ed9598eca780-ec958aec9d84-eab2bdec9ab0/" class="list-group-item">AWS Credentials가 upstart 등에서 제대로 동작하지 않을 경우</a>
      
      <a href="https://jeidee.github.io/2016/09/02/c-rest-sdk/" class="list-group-item">c&#43;&#43; REST SDK</a>
      
      <a href="https://jeidee.github.io/2016/09/01/c-openssl-aes-ecb/" class="list-group-item">c&#43;&#43; openssl AES ECB</a>
      
      <a href="https://jeidee.github.io/2016/09/01/cc-hex-string-to-byte-array/" class="list-group-item">c/c&#43;&#43; hex string to byte array</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/categories/erlang" class="list-group-item">erlang</a>
      
      <a href="https://jeidee.github.io/categories/ejabberd" class="list-group-item">ejabberd</a>
      
      <a href="https://jeidee.github.io/categories/elixir" class="list-group-item">elixir</a>
      
      <a href="https://jeidee.github.io/categories/ios" class="list-group-item">ios</a>
      
      <a href="https://jeidee.github.io/categories/c&#43;&#43;" class="list-group-item">c&#43;&#43;</a>
      
      <a href="https://jeidee.github.io/categories/node.js" class="list-group-item">node.js</a>
      
      <a href="https://jeidee.github.io/categories/utility" class="list-group-item">utility</a>
      
      <a href="https://jeidee.github.io/categories/android" class="list-group-item">android</a>
      
      <a href="https://jeidee.github.io/categories/go" class="list-group-item">go</a>
      
      <a href="https://jeidee.github.io/categories/couchbase" class="list-group-item">couchbase</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="https://jeidee.github.io/tags/tutorial" class="list-group-item">tutorial</a>
      
      <a href="https://jeidee.github.io/tags/ndk" class="list-group-item">ndk</a>
      
      <a href="https://jeidee.github.io/tags/express" class="list-group-item">express</a>
      
      <a href="https://jeidee.github.io/tags/mnesia" class="list-group-item">mnesia</a>
      
      <a href="https://jeidee.github.io/tags/mysql" class="list-group-item">mysql</a>
      
      <a href="https://jeidee.github.io/tags/cberl" class="list-group-item">cberl</a>
      
      <a href="https://jeidee.github.io/tags/clustering" class="list-group-item">clustering</a>
      
      <a href="https://jeidee.github.io/tags/custom-module" class="list-group-item">custom-module</a>
      
      <a href="https://jeidee.github.io/tags/debug" class="list-group-item">debug</a>
      
      <a href="https://jeidee.github.io/tags/http" class="list-group-item">http</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; Erlang &amp; Go</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

