<!DOCTYPE html>
<html lang="ko-kr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Erlang &amp; Go  | ejabberd external component 연동</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.51" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="ejabberd external component 연동" />
<meta property="og:description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.
Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.
xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.
echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jeidee.github.io/2015/03/04/ejabberd-external-component-ec97b0eb8f99/" /><meta property="article:published_time" content="2015-03-04T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2015-03-04T00:00:00&#43;00:00"/>

<meta itemprop="name" content="ejabberd external component 연동">
<meta itemprop="description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.
Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.
xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.
echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.">


<meta itemprop="datePublished" content="2015-03-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2015-03-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="345">



<meta itemprop="keywords" content="bot,component," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ejabberd external component 연동"/>
<meta name="twitter:description" content="xmpp component 개요 xmpp에는 external component 관련 공식 프로토콜인 Jabber Component Protocol이 있다.
Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.
xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 Install Components and Transports to othe networks 문서를 참고하도록 한다.
echo-bot component 만들어서 연동해 보기 node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://jeidee.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Erlang &amp; Go
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">ejabberd external component 연동</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2015-03-04T00:00:00Z">March 4, 2015</time>      
      
      
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<h2 id="xmpp-component-개요">xmpp component 개요</h2>

<p>xmpp에는 external component 관련 공식 프로토콜인 <a href="http://xmpp.org/extensions/xep-0114.html">Jabber Component Protocol</a>이 있다.</p>

<p>Jabber Component Protocol은 외부 컴포넌트를 XMPP서버와 연동하기 위한 규약을 제안하는데 크게 accept와 connect에 대한 XML 스키마와 handshake flow를 명세하고 있다.</p>

<p>xmpp의 external component는 프로토콜만 준수한다면 어떤 언어를 사용해서도 구현할 수 있다. 3rd-party 컴포넌트를 ejabberd와 연동하는 방법은 <a href="https://www.ejabberd.im/tutorials-transports">Install Components and Transports to othe networks</a> 문서를 참고하도록 한다.</p>

<h2 id="echo-bot-component-만들어서-연동해-보기">echo-bot component 만들어서 연동해 보기</h2>

<p>node-xmpp-component 모듈을 사용해서 간단한 에코봇을 컴포넌트로 만들어 ejabberd와 연동해 보도록 하자.</p>

<p>우선 다음과 같이 node-xmpp-component와 node-xmpp-core를 설치한다.</p>

<pre><code>  
$ npm install node-xmpp-component
  
$ npm install node-xmpp-core
  
</code></pre>

<p>다음과 같이 에코 봇을 작성한다.</p>

<pre><code class="language-javascript">  
var Component = require('node-xmpp-component')
      
, argv = process.argv
      
, ltx = require('node-xmpp-core').ltx

if (argv.length &lt; 6) {
      
console.error('Usage: node echo_bot.js &lt;my-jid&gt; &lt;my-password&gt; ' +
      
'&lt;server&gt; &lt;port&gt;')
      
process.exit(1)
  
}

var component = new Component({
      
jid: argv[2],
      
password: argv[3],
      
host: argv[4],
      
port: Number(argv[5]),
      
reconnect: true
  
})

component.on('online', function() {
      
console.log('Component is online')

component.on('stanza', function(stanza) {
          
console.log('Received stanza: ', stanza)
          
if (stanza.is('message') &amp;&amp; stanza.attrs.type === 'chat') {
              
var i = parseInt(stanza.getChildText('body'))
              
var reply = new ltx.Element('message', { to: stanza.attrs.from, from: stanza.attrs.to, type: 'chat' })
              
reply.c('body').t(stanza)
              
component.send(reply)
          
}
      
})
  
})

component.on('offline', function () {
      
console.log('Component is offline')
  
})

component.on('connect', function () {
      
console.log('Component is connected')
  
})

component.on('reconnect', function () {
      
console.log('Component reconnects …')
  
})

component.on('disconnect', function (e) {
      
console.log('Component is disconnected', e)
  
})

component.on('error', function(e) {
      
console.error(e)
      
process.exit(1)
  
})

process.on('exit', function () {
      
component.end()
  
})
  
</code></pre>

<p>ejabberd.yml을 다음과 같이 수정한다.</p>

<pre><code>  
##
    
\## ejabberd_service: Interact with external components (transports, &amp;#8230;)
    
##
    
&amp;#8211;
       
port: 8888
       
module: ejabberd_service
       
access: all
       
shaper_rule: fast
       
ip: &quot;127.0.0.1&quot;
       
hosts:
         
&quot;foo.hello.world&quot;:
           
password: &quot;foo&quot;

</code></pre>

<p>ejabberd를 시작한 후 다음과 같이 컴포넌트를 시작한다.</p>

<pre><code>  
$ ejabberdctl start
  
$ node echo_bot.js foo.hello.world foo localhost 8888
  
</code></pre>

<p>정상적으로 연결이 될 경우 다음과 같은 메세지가 출력된다.</p>

<pre><code>  
Component is connected
  
Component is online
  
</code></pre>

<p>이 상태에서 XMPP 클라이언트로 접속한 후 foo.hello.world에게 메세지를 전송해 보자.</p>

<p>문제가 없을 경우 보낸 메세지가 다시 내게로 돌아오게 된다.</p>

<h2 id="활용">활용</h2>

<p>xmpp component의 활용은 다양하게 활용될 수 있다. 다른 메신저 서비스에 메세지 라우팅을 하거나, 날씨/사전/FAQ등의 봇 서비스에 활용될 수도 있다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="https://www.ejabberd.im/tutorials-transports">Install Components and Transports to Other Networks</a></li>
<li><a href="https://www.ejabberd.im/node/5134">Configuring Ejabberd to use an external component (with XEP-0114)</a></li>
<li><a href="http://xmpp.org/extensions/xep-0114.html">Jabber Component Protocol</a></li>
<li><a href="https://github.com/node-xmpp/node-xmpp-component">node-xmpp-component</a></li>
</ul>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/bot" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">bot</a>
   </li>
  
   <li class="list">
     <a href="/tags/component" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">component</a>
   </li>
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-erlnote-wordpress-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://jeidee.github.io/" >
    &copy; 2018 Erlang &amp; Go
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
