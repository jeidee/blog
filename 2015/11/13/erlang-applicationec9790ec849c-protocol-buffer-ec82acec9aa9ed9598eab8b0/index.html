<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>erlang application에서 protocol buffer 사용하기</title>
	
	
	<link rel="stylesheet" href="https://jeidee.github.io/css/style.css">
	
	<meta name="generator" content="Hugo 0.31.1" />
</head>
<body>
	<header>
		<a href="https://jeidee.github.io/">Erlang &amp; Go</a>
		<nav>
			<ul>
				
			</ul>
		</nav>
	</header>
	<main>
		<article>
			<h1>erlang application에서 protocol buffer 사용하기</h1>
			<time>13.11.2015 00:00</time>
			<div>
				

<p>이번 역시, <a href="https://erlnote.wordpress.com/2015/11/06/erlang-rebar%EC%9D%98-project-template%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-application-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0/">rebar를 사용해 프로젝트를 생성</a>했다고 가정한다.</p>

<p>basho의 protobuffs 라이브러리를 추가해 보도록 하자.</p>

<h2 id="rebar-config-수정">rebar.config 수정</h2>

<p><a href="https://erlnote.wordpress.com/2015/11/11/erlang-application%EC%97%90-lager%EB%A1%9C%EA%B1%B0-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0/">이전 포스트</a>를 참고해서 기본 작업(sub_dirs 추가 등)은 완료했다고 가정한다.</p>

<pre><code>  
{deps, [
  
{'lager', &quot;.*&quot;, {git, &quot;https://github.com/basho/lager&quot;, &quot;&quot;}},
  
{protobuffs, &quot;.*&quot;, {git, &quot;git://github.com/basho/erlang_protobuffs.git&quot;, {branch, &quot;master&quot;}}}
  
]}.
  
</code></pre>

<ul>
<li>deps에 protobuffs, &#8230; 행을 복사해 넣는다.</li>
</ul>

<h2 id="xxx-proto-파일-생성">xxx.proto 파일 생성</h2>

<p>프로토콜을 정의한 *.proto파일을 생성한다.</p>

<p>예를 들면 다음과 같은 simple.proto파일을 src 디렉토리 밑에 추가한다.</p>

<pre><code>  
package simple;

message Person {
  
required string name = 1;
  
required string address = 2;
  
required string phone_number = 3;
  
required int32 age = 4;
  
optional Location location = 5;
  
}

message Location
  
{
  
required string region = 1;
  
required string country = 2;
  
}
  
</code></pre>

<p>make로 컴파일하고 나면 rebar가 .proto파일을 자동으로 인식해 include 디렉토리(src와 동일 레벨)를 생성하고, simple_pb.hrl파일을 생성한다.</p>

<p>simple_pb.erl파일은 컴파일 완료 후 ebin 디렉토리에 simple_pb.beam 파일을 생성 후 자동으로 삭제된다.</p>

<h2 id="테스트">테스트</h2>

<p>make console 명령으로 console에서 어플리케이션을 시작한다.</p>

<p>erl쉘이 출력되면 다음과 같이 encoding, decoding을 할 수 있다.</p>

<ul>
<li>simple_pb.hrl에는 record가 정의되어 있지만 쉘에서는 rd()명령어로 레코드를 정의후 테스트할 수 있다.</li>
</ul>

<pre><code>  
&gt; rd(location, {region, country}).
  
&gt; L1 = simple\_pb:encode\_location(#region{region=&quot;Korea&quot;, country=&quot;Seoul&quot;}).
  
&gt; L2 = list\_to\_binary(L1).
  
&gt; simple\_pb:decode\_location(L2).
  
</code></pre>

<h2 id="참고">참고</h2>

<p>좀 더 자세한 내용은 다음 링크를 참고한다.</p>

<ul>
<li><a href="https://github.com/basho/erlang_protobuffs">erlang_protobuffs</a></li>
</ul>

			</div>
			<div>
				<ul id="tags">
					
					<li><a href="/tags/google-protocol-buffer">google protocol buffer</a> </li>
					
					<li><a href="/tags/gpb">gpb</a> </li>
					
					<li><a href="/tags/proto">proto</a> </li>
					
				</ul>
			</div>
			<div>
				<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-erlnote-wordpress-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>
		</article>
	</main>
	<aside>
		<div>
			<div>
				<h3>LATEST POSTS</h3>
			</div>
			<div>
				<ul>
					
					<li><a href="https://jeidee.github.io/2017/08/31/upstart-ec84a4eca095/">upstart 설정</a></li>
					
					<li><a href="https://jeidee.github.io/2017/06/08/centosec9790ec849c-mongodb-ec84a4ecb998ec9980-service-eb93b1eba19d/">CentOS에서 MongoDB 설치와 Service 등록</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080/">couchbase cberl에 lcb_cntl 함수 추가</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd/">couchbase cberl의IO Plugin을 libevent로 변경</a></li>
					
					<li><a href="https://jeidee.github.io/2017/01/25/ejabberdec9d98-deps-eb9dbcec9db4ebb88ceb9faceba6ac-ec8898eca095-ed9b84-ecbbb4ed8c8cec9dbcec9790ec849c-eb8884eb9dbdeb90a0-eb958c/">ejabberd의 deps 라이브러리 수정 후 컴파일에서 누락될 때</a></li>
					
				</ul>
			</div>
		</div>
	</aside>

	<footer>
		<p>&copy; 2017 <a href="https://jeidee.github.io/">Erlang &amp; Go</a></p>
	</footer>
</body>
</html>