<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Erlang &amp; Go  | Cberl</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.31.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    <link href='http://jeidee.github.io/dist/main.css' rel='stylesheet' type="text/css" />
    
      
    

    
      <link href="http://jeidee.github.io/tags/cberl/index.xml" rel="alternate" type="application/rss+xml" title="Erlang &amp; Go" />
      <link href="http://jeidee.github.io/tags/cberl/index.xml" rel="feed" type="application/rss+xml" title="Erlang &amp; Go" />
    

    <meta property="og:title" content="Cberl" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://jeidee.github.io/tags/cberl/" />



<meta property="og:updated_time" content="2017-01-25T00:00:00&#43;00:00"/>










<meta itemprop="name" content="Cberl">
<meta itemprop="description" content="">

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Cberl"/>
<meta name="twitter:description" content=""/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  
  
  <header class="cover bg-top" style="background-image: url('http://jeidee.github.io/images/gohugo-default-sample-hero-image.jpg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://jeidee.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Erlang &amp; Go
    </a>
    <div class="flex-l items-center">
      
      








    </div>
  </div>
</nav>

      <div class="tc-l pv4 pv6-l ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 white-90 mb0 lh-title">
          Cberl
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links nested-img mid-gray">
      <p>Below you will find pages that utilize the taxonomy term “Cberl”</p>
    </div>
  </article>
  <div class="mw8 center">
    
    <section class="flex-ns flex-wrap justify-around mt5">
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/2017/01/25/couchbase-cberlec9790-lcb_cntl-ed95a8ec8898-ecb694eab080" class="link black dim">
        couchbase cberl에 lcb_cntl 함수 추가
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      cberl에 libcouchbase의 옵션을 설정하거나 조회할 수 있는 lcb_cntl 함수를 추가해 보자.
새로운 함수 추가를 위해 코맨드 상수를 추가해 준다.
cberl_nif.h를 열어 다음행을 추가해 준다.
#define CMD_CNTL 8  새로운 코맨드에 콜백함수를 등록해 주기 위해서 cberl_nif.c소스의 NIF(cberl_nif_new) 함수에 다음행을 추가해 준다.
https://gist.github.com/jeidee/86967c348f64cee9b37c6bf41c207606
cntl 함수의 매개변수를 위한 구조체와 함수선언문을 cb.h에 다음과 같이 추가한다.
https://gist.github.com/jeidee/430f7cea10bc95099cafb79e71407f42
cntl 함수 정의부를 cb.c에 다음과 같이 작성한다.
https://gist.github.com/jeidee/07acab77aad96f32b4f79110ae202209
이제 erlang 소스를 수정해 보자.
cntl 함수가 erlang에서 호출될 수 있도록 cberl.
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/2017/01/25/couchbase-cberlec9d98io-pluginec9d84-libeventeba19c-ebb380eab2bd" class="link black dim">
        couchbase cberl의IO Plugin을 libevent로 변경
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      cberl에는 io plugin이 default로 설정되어 있는데 이럴 경우 select를 사용한다. 동시에 열 수 있는 소켓수는 1024로 제한되어 있어, 그 이상을 처리하기 위해서는 libevent로 수정해야 한다.
그렇지 않을 경우 cberl의 view(http)를 사용할 경우 일정한 요청(동시에 열린 소켓수가 1024를 초과하는 시점) 이상일 경우 간헐적으로 unknown error 45(0x2d)를 반환한다.
실제 libcouchbase의 로그를 cntl함수를 사용해 erlang application process에 attach된 상태에서 stderr에 출력되는 로그를 확인해 보면 다음과 같은 오류가 출력되는 것을 확인할 수 있다.
(cberl:cntl 함수를 사용하려면 이전 포스트를 참고해서 cberl 소스를 수정해야 한다.
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/2016/01/15/couchbase-cberl-ec82acec9aa9ed95b4ec849c-view-eca1b0ed9a8cec8b9c-eca3bcec9d98ec82aced95ad" class="link black dim">
        couchbase cberl 사용해서 view 조회시 주의사항
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      couchbase의 view 조회시 데이터의 최신 본을 얻지 못할 수도 있다.
이러한 이유는 속도의 향상을 위해 stale옵션의 기본값이 true로 설정되어 있어서 그런데, 명시적으로 stale옵션을 false로 지정해야 최신 데이터가 적용된 view를 구할 수 있다.
cberl:view()함수를 사용할 때, stale옵션을 false로 지정하는 방법은 다음과 같다.
https://gist.github.com/jeidee/79e08693d3c6be338e31
Args에 {stale, false}를 추가하면 된다.
    </div>
  </div>
</div>

        </div>
      
    </section>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://jeidee.github.io/" >
    &copy; 2017 Erlang &amp; Go
  </a>
  








  </div>
</footer>

    <script src="http://jeidee.github.io/dist/app.bundle.js" async></script>

  </body>
</html>
