---
id: 289
title: nGrinder와 smack api를 사용해 ejabberd 테스트하기
date: 2015-03-30T09:19:57+00:00
author: jeidee
layout: post
guid: https://erlnote.wordpress.com/?p=289
permalink: '/2015/03/30/ngrinder%ec%99%80-smack-api%eb%a5%bc-%ec%82%ac%ec%9a%a9%ed%95%b4-ejabberd-%ed%85%8c%ec%8a%a4%ed%8a%b8%ed%95%98%ea%b8%b0/'
categories:
  - ejabberd
tags:
  - nGrinder
  - smack
---
## 테스트 환경

smack api는 3.2.2, nGrinder는 3.3 버전이다.

192.168.56.101서버에 ejabberd가 실행중이고, ngrinder-controller, -agent, -monitor가 실행중이라고 가정한다.

## 테스트 스크립트 작성

1) Script > Create a script 버튼을 클릭해 다음과 같이 스크립트를 만들어 준다.

> Script Name : testXmpp
    
> Type : Groovy
    
> URL to be tested :
    
> Create Lib and Resource folders : Check 

2) smack-3.2.2.jar 파일을 lib 폴더에 업로드한다.

3) 만들어진 스크립트를 다음과 같이 수정한다.

testXmpp.groovy

```groovy
  
package org.ngrinder;

import static net.grinder.script.Grinder.grinder
  
import static org.junit.Assert.*
  
import static org.hamcrest.Matchers.*
  
import net.grinder.plugin.http.HTTPRequest
  
import net.grinder.plugin.http.HTTPPluginControl;
  
import net.grinder.script.GTest
  
import net.grinder.script.Grinder
  
import net.grinder.scriptengine.groovy.junit.GrinderRunner
  
import net.grinder.scriptengine.groovy.junit.annotation.BeforeProcess
  
import net.grinder.scriptengine.groovy.junit.annotation.BeforeThread
  
import static net.grinder.util.GrinderUtils.* // You can use this if you're using nGrinder after 3.2.3
  
import org.junit.Before
  
import org.junit.BeforeClass
  
import org.junit.Test
  
import org.junit.runner.RunWith

import HTTPClient.HTTPResponse
  
import HTTPClient.NVPair

import org.jivesoftware.smack.*

/**
   
* A simple example using the HTTP plugin that shows the retrieval of a
   
* single page via HTTP.
   
*
   
* This script is automatically generated by ngrinder.
   
*
   
* @author admin
   
*/
  
@RunWith(GrinderRunner)
  
class TestRunner {
      
public static GTest test

@BeforeProcess
      
public static void beforeProcess() {
          
test = new GTest(1, "Test1")
          
test.record(this, "connTest");

grinder.logger.info("before process.");
      
}

public connTest() {
          
def processNumber = grinder.processNumber
          
def threadNumber = grinder.threadNumber
          
def no = (processNumber * 100 + threadNumber) + 1

def user = "test" + no.toString()
          
def (host, port) = getParam('192.168.56.101,5222').tokenize(',') // '192.168.56.101,5222'.tokenize(',')

ConnectionConfiguration config = new ConnectionConfiguration(host, port.toInteger(), "bypass")
          
XMPPConnection conn = new XMPPConnection(config)

conn.connect()
          
conn.login(user, "1234")

if (!conn.isConnected()) {
              
grinder.logger.warn("Not Connected");
          
}
          
//else {
          
// grinder.logger.info("Connected {}", user);
          
//}

assertThat(conn.isConnected(), is(true));

conn.disconnect()
      
}

@BeforeThread
      
public void beforeThread() {
          
grinder.statistics.delayReports=true;
          
grinder.logger.info("before thread.");
      
}

@Test
      
public void test(){
          
connTest()
      
}
  
}
  
```

중요한 부분은 다음과 같다.

```
  
import org.jivesoftware.smack.*

public static void beforeProcess() {
          
&#8230;
          
test.record(this, "connTest");
          
&#8230;

public connTest() {
          
&#8230;
      
}
  
```

4) Performance Test > Create Test 버튼을 클릭해 테스트를 생성한다.

  * Basic Configuration
  
    > Agent : 1
  
    > Vuser per agent : 10 (Processes 2 : Threads 5)
  
    > Script : testXmpp.groovy
  
    > Script Resrouces : lib/smack-3.2.2.jar
  
    > Target Host : 192.168.56.101
  
    > Run Count : 100
  
    > Process/Thread : Process

## 참고

  * [스크립트에 파라미터 전달하기](http://junoyoon.tistory.com/entry/%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%97%90-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%A0%84%EB%8B%AC%ED%95%98%EA%B8%B0)
  * [Advanced nGrinder 2nd edition](http://www.slideshare.net/junhoyoon3994/advanced-ngrinder-2nd-edition-31708091)